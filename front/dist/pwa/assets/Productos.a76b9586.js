import{_ as G,aY as N,O as d,P as k,Q as s,R as t,aI as f,T as l,S as p,aG as b,$ as x,X as h,Y as D,Z as Q,aH as w,U as r,W as I,aJ as F,V as v,a2 as H,J as y,bf as B}from"./index.05ec8a00.js";import{Q as T}from"./QPagination.df0eba8b.js";import{a as C,b as m}from"./QMenu.20988a0c.js";import{Q as P}from"./QItemLabel.be1b8919.js";import{Q as z}from"./QList.28c1a32b.js";import{Q as L}from"./QBtnDropdown.42d141fb.js";import{Q as E}from"./QImg.b1b3723e.js";import{Q as q}from"./QMarkupTable.60ba416e.js";import{Q as _}from"./QSpace.0cf68ae0.js";import{Q as O}from"./QForm.cfde9f35.js";import{Q as M}from"./QPage.25b4f3bb.js";import{C as V}from"./ClosePopup.cd1cf7f0.js";import"./moment.40bc58bf.js";import{E as R}from"./Excel.a5e16faf.js";import"./format.2cae61da.js";import"./QBtnGroup.5b18e740.js";import"./_commonjsHelpers.a26ce4be.js";const j={name:"ProductosPage",data(){return{productos:[],producto:{},productoFoto:null,fotoPreview:null,productoDialog:!1,loading:!1,actionPeriodo:"",filter:"",pagination:{page:1,rowsPerPage:15,rowsNumber:0},columns:[{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"unidad",label:"Presentacion",align:"left",field:"unidad"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stock",label:"Stock",align:"left",field:"stock"},{name:"stock_minimo",label:"Stock m\xEDnimo",align:"left",field:"stock_minimo"},{name:"stock_maximo",label:"Stock m\xE1ximo",align:"left",field:"stock_maximo"}],historialDialog:!1,historialCompras:[],productoHistorialNombre:"",dialogFoto:!1}},mounted(){this.productosGet(),this.debouncedCambioPrecio=N(this.cambioPrecio,500),this.debouncedCambioStock=N(this.cambioStock,500)},methods:{onFotoChange(i){const e=i.target.files[0];!e||(this.productoFoto=e,this.fotoPreview=URL.createObjectURL(e))},onFileChange(i){const e=i.target.files[0];if(e){const u=new FormData;u.append("file",e),this.loading=!0,this.$axios.post(`productos/${this.producto.id}/foto`,u,{headers:{"Content-Type":"multipart/form-data"}}).then(g=>{this.productosGet(),this.$alert.success("Foto actualizada"),this.dialogFoto=!1}).catch(g=>{this.$alert.error(g.response.data.message)}).finally(()=>{this.loading=!1})}},productoEditFoto(i){this.dialogFoto=!0,this.producto={...i}},verHistorial(i){this.loading=!0,this.productoHistorialNombre=i.nombre,this.$axios.get(`productos/${i.id}/historial-compras`).then(e=>{this.historialCompras=e.data,this.historialDialog=!0}).catch(e=>{this.$alert.error("Error al obtener historial")}).finally(()=>{this.loading=!1})},cambioStock(i){this.loading=!0,this.$axios.put("productos/"+i.id,{stock:i.stock}).then(e=>{this.productosGet(),this.$alert.success("Stock actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioPrecio(i){this.loading=!0,this.$axios.put("productos/"+i.id,{precio:i.precio}).then(e=>{this.productosGet(),this.$alert.success("Precio actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},exportExcel(){this.loading=!0,this.$axios.get("productosAll").then(i=>{let e=[{columns:[{label:"Nombre",value:"nombre"},{label:"Descripci\xF3n",value:"descripcion"},{label:"Unidad",value:"unidad"},{label:"Precio",value:"precio"},{label:"Stock",value:"stock"},{label:"Stock m\xEDnimo",value:"stock_minimo"},{label:"Stock m\xE1ximo",value:"stock_maximo"}],content:i.data}];R.export(e,"Productos")}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},productoNew(){this.producto={},this.productoFoto=null,this.fotoPreview=null,this.actionPeriodo="Nuevo",this.productoDialog=!0},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.filter,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(i=>{this.productos=i.data.data,this.pagination.rowsNumber=i.data.total}).catch(i=>{var e,u;this.$alert.error(((u=(e=i.response)==null?void 0:e.data)==null?void 0:u.message)||"Error al cargar productos")}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(i=>{this.gestiones=i.data,this.loading=!1}).catch(i=>{this.$alert.error(i.response.data.message),this.loading=!1})},productoPost(){this.loading=!0;const i=new FormData;Object.keys(this.producto).forEach(e=>{i.append(e,this.producto[e])}),this.productoFoto&&i.append("foto",this.productoFoto),this.$axios.post("productos",i,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.productosGet(),this.productoDialog=!1,this.$alert.success("Producto creado")}).catch(e=>{var u,g;this.$alert.error(((g=(u=e.response)==null?void 0:u.data)==null?void 0:g.message)||"Error")}).finally(()=>{this.loading=!1})},productoPut(){this.loading=!0,this.$axios.put("productos/"+this.producto.id,this.producto).then(i=>{this.productosGet(),this.productoDialog=!1,this.$alert.success("Periodo actualizado")}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})},productoEdit(i){this.producto={...i},this.actionPeriodo="Editar",this.productoDialog=!0},productoDelete(i){this.$alert.dialog("\xBFDesea eliminar el producto?").onOk(()=>{this.loading=!0,this.$axios.delete("productos/"+i).then(e=>{this.productosGet(),this.$alert.success("Periodo eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},J={class:"text-right"},K={class:"flex flex-center"},Y={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},A={style:{"max-width":"200px","wrap-option":"wrap","line-height":"0.9"}},W={style:{"max-width":"80px","wrap-option":"wrap","line-height":"0.9"}},X=["onUpdate:modelValue","onKeyup"],Z={class:"q-mt-sm"},$={key:0,class:"q-mt-sm"},ee={class:"text-right q-mt-md"},oe={class:"text-h6"},te=["src"];function le(i,e,u,g,a,n){return d(),k(M,{class:"q-pa-xs"},{default:s(()=>[t(w,{flat:"",bordered:""},{default:s(()=>[t(f,{class:"q-pa-xs"},{default:s(()=>[l("div",J,[t(p,{color:"primary",label:"Descargar","no-caps":"",icon:"fa-solid fa-file-excel",loading:a.loading,onClick:n.exportExcel},null,8,["loading","onClick"]),t(p,{color:"green",label:"Nuevo",onClick:n.productoNew,"no-caps":"",icon:"add_circle_outline",loading:a.loading},null,8,["onClick","loading"]),t(b,{modelValue:a.filter,"onUpdate:modelValue":[e[0]||(e[0]=o=>a.filter=o),n.productosGet],label:"Buscar",dense:"",outlined:"",debounce:"300"},{append:s(()=>[t(x,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",K,[t(T,{modelValue:a.pagination.page,"onUpdate:modelValue":[e[1]||(e[1]=o=>a.pagination.page=o),n.productosGet],max:Math.ceil(a.pagination.rowsNumber/a.pagination.rowsPerPage),"rows-per-page-options":[10,25,50,100],"rows-per-page":a.pagination.rowsPerPage,"rows-number":a.pagination.rowsNumber,color:"primary","boundary-numbers":"","max-pages":"5"},null,8,["modelValue","max","rows-per-page","rows-number","onUpdate:modelValue"])]),t(q,{dense:"","wrap-cells":""},{default:s(()=>[l("thead",null,[l("tr",null,[e[19]||(e[19]=l("th",null,"Opciones",-1)),e[20]||(e[20]=l("th",null,"Imagen",-1)),(d(!0),h(Q,null,D(a.columns,o=>(d(),h("th",{key:o.name,class:H(o.align)},r(o.label),3))),128))])]),l("tbody",null,[(d(!0),h(Q,null,D(a.productos,o=>(d(),h("tr",{key:o.id},[l("td",null,[t(L,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[t(z,null,{default:s(()=>[y((d(),k(C,{clickable:"",onClick:c=>n.productoEdit(o)},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(x,{name:"edit"})]),_:1}),t(m,null,{default:s(()=>[t(P,null,{default:s(()=>e[21]||(e[21]=[v("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),y((d(),k(C,{clickable:"",onClick:c=>n.productoDelete(o.id)},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(x,{name:"delete"})]),_:1}),t(m,null,{default:s(()=>[t(P,null,{default:s(()=>e[22]||(e[22]=[v("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),y((d(),k(C,{clickable:"",onClick:c=>n.verHistorial(o)},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(x,{name:"history"})]),_:1}),t(m,null,{default:s(()=>[t(P,null,{default:s(()=>e[23]||(e[23]=[v("Historial de compras")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]]),y((d(),k(C,{clickable:"",onClick:c=>n.productoEditFoto(o)},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(x,{name:"photo"})]),_:1}),t(m,null,{default:s(()=>[t(P,null,{default:s(()=>e[24]||(e[24]=[v("Ver foto")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),l("td",null,[t(E,{src:`${i.$url}../images/${o.imagen}`,style:{width:"50px",height:"50px"},class:"q-mr-sm"},null,8,["src"])]),l("td",null,[l("div",Y,r(o.nombre),1)]),l("td",null,[l("div",A,r(o.descripcion),1)]),l("td",null,[l("div",W,r(o.unidad),1)]),l("td",null,[y(l("input",{"onUpdate:modelValue":c=>o.precio=c,type:"number",step:"0.01",min:"0",style:{width:"60px","text-align":"right"},onKeyup:c=>i.debouncedCambioPrecio(o)},null,40,X),[[B,o.precio,void 0,{number:!0}]])]),l("td",null,r(o.cantidad),1),l("td",null,r(o.stock_minimo),1),l("td",null,r(o.stock_maximo),1)]))),128))])]),_:1})]),_:1})]),_:1}),t(F,{modelValue:a.productoDialog,"onUpdate:modelValue":e[12]||(e[12]=o=>a.productoDialog=o),persistent:""},{default:s(()=>[t(w,{style:{width:"400px",margin:"0 auto"}},{default:s(()=>[t(f,{class:"q-pb-none row items-center"},{default:s(()=>[l("div",null,r(a.actionPeriodo)+" producto ",1),t(_),t(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[2]||(e[2]=o=>a.productoDialog=!1)})]),_:1}),t(f,{class:"q-pt-none"},{default:s(()=>[t(O,{onSubmit:e[11]||(e[11]=o=>a.producto.id?n.productoPut():n.productoPost())},{default:s(()=>[t(b,{modelValue:a.producto.nombre,"onUpdate:modelValue":e[3]||(e[3]=o=>a.producto.nombre=o),label:"Nombre",dense:"",outlined:""},null,8,["modelValue"]),t(b,{modelValue:a.producto.descripcion,"onUpdate:modelValue":e[4]||(e[4]=o=>a.producto.descripcion=o),label:"Descripci\xF3n",dense:"",outlined:""},null,8,["modelValue"]),t(b,{modelValue:a.producto.unidad,"onUpdate:modelValue":e[5]||(e[5]=o=>a.producto.unidad=o),label:"Unidad",dense:"",outlined:""},null,8,["modelValue"]),t(b,{modelValue:a.producto.precio,"onUpdate:modelValue":e[6]||(e[6]=o=>a.producto.precio=o),label:"Precio",dense:"",outlined:"",type:"number"},null,8,["modelValue"]),t(b,{modelValue:a.producto.stock,"onUpdate:modelValue":e[7]||(e[7]=o=>a.producto.stock=o),label:"Stock",dense:"",outlined:""},null,8,["modelValue"]),l("div",Z,[t(p,{label:"Seleccionar foto",icon:"photo",color:"primary","no-caps":"",dense:"",onClick:e[8]||(e[8]=o=>i.$refs.fotoInput.click())}),l("input",{type:"file",ref:"fotoInput",accept:"image/*",style:{display:"none"},onChange:e[9]||(e[9]=(...o)=>n.onFotoChange&&n.onFotoChange(...o))},null,544)]),a.fotoPreview?(d(),h("div",$,[t(E,{src:a.fotoPreview,style:{width:"120px",height:"120px"},"spinner-color":"primary"},null,8,["src"])])):I("",!0),l("div",ee,[t(p,{label:"Cancelar",color:"negative",flat:"",onClick:e[10]||(e[10]=o=>a.productoDialog=!1)}),t(p,{label:"Guardar",color:"primary",type:"submit","no-caps":""})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(F,{modelValue:a.historialDialog,"onUpdate:modelValue":e[14]||(e[14]=o=>a.historialDialog=o),persistent:""},{default:s(()=>[t(w,{style:{width:"800px"}},{default:s(()=>[t(f,{class:"row items-center q-pb-none"},{default:s(()=>[l("div",oe,"Historial de Compras: "+r(a.productoHistorialNombre),1),t(_),t(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[13]||(e[13]=o=>a.historialDialog=!1)})]),_:1}),t(f,{class:"q-pt-none"},{default:s(()=>[t(q,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:s(()=>[e[25]||(e[25]=l("thead",null,[l("tr",null,[l("th",null,"#"),l("th",null,"Fecha"),l("th",null,"Proveedor"),l("th",null,"Lote"),l("th",null,"Vencimiento"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Total")])],-1)),l("tbody",null,[(d(!0),h(Q,null,D(a.historialCompras,(o,c)=>{var S,U;return d(),h("tr",{key:o.id},[l("td",null,r(c+1),1),l("td",null,r((S=o.compra)==null?void 0:S.fecha),1),l("td",null,r(o.lote),1),l("td",null,r((U=o.proveedor)==null?void 0:U.nombre),1),l("td",null,r(o.fecha_vencimiento),1),l("td",null,r(o.cantidad),1),l("td",null,r(o.precio),1),l("td",null,r(o.total),1)])}),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(F,{modelValue:a.dialogFoto,"onUpdate:modelValue":e[18]||(e[18]=o=>a.dialogFoto=o)},{default:s(()=>[t(w,{style:{width:"400px"}},{default:s(()=>[t(f,{class:"q-pb-none text-bold row items-center"},{default:s(()=>[v(" Cambiar foto de producto "+r(a.producto.nombre)+" ",1),t(_),t(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[15]||(e[15]=o=>a.dialogFoto=!1)})]),_:1}),t(f,{class:"row items-center q-pb-none"},{default:s(()=>[t(p,{label:"Subir foto",color:"primary",onClick:e[16]||(e[16]=o=>i.$refs.fileInput.click()),class:"q-mr-sm","no-caps":"",dense:"",icon:"cloud_upload",loading:a.loading},null,8,["loading"]),l("input",{type:"file",ref:"fileInput",accept:"image/*",onChange:e[17]||(e[17]=(...o)=>n.onFileChange&&n.onFileChange(...o)),style:{display:"none"}},null,544),l("img",{src:`${i.$url}../images/${a.producto.imagen}`,style:{width:"350px",height:"350px"},class:"q-mr-sm"},null,8,te)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ye=G(j,[["render",le]]);export{ye as default};
