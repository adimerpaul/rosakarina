import{_ as B,O as m,X as b,R as e,Q as a,T as o,Z as Q,aH as v,aI as _,$ as h,V as d,U as r,aG as k,S as x,Y as D,J as w,P as I}from"./index.594913b0.js";import{Q as f,a as n}from"./QItem.68a53dc1.js";import{Q as p}from"./QItemLabel.7c1abc4c.js";import{Q as F}from"./QSelect.3a86fb17.js";import{Q as A}from"./QBtnDropdown.3d0e055a.js";import{Q as T}from"./QChip.b9f8b884.js";import{Q as E}from"./QMarkupTable.19a2d68e.js";import{Q as G}from"./QPage.d9564769.js";import{C as V}from"./ClosePopup.c2724866.js";import{h as y}from"./moment.40bc58bf.js";import{I as Y}from"./Imprimir.114281d9.js";import{E as U}from"./Excel.a5e16faf.js";import"./QMenu.a2aeb986.js";import"./format.2cae61da.js";import"./QBtnGroup.32f2cbbe.js";import"./_commonjsHelpers.a26ce4be.js";const P={data(){return{compras:[],fechaInicio:y().format("YYYY-MM-DD"),fechaFin:y().format("YYYY-MM-DD"),user:"",users:[],proveedor_id:"",proveedores:[],loading:!1}},mounted(){this.comprasGet(),this.usersGet(),this.proveedoresGet()},computed:{proveedoresTodos(){return[{label:"Todos",value:""},...this.proveedores.map(t=>({label:t.nombre,value:t.id}))]},usersTodos(){return[{label:"Todos",value:""},...this.users.map(t=>({label:t.name,value:t.id}))]},totalCompras(){return this.compras.reduce((t,l)=>l.estado==="Activo"?t+parseFloat(l.total):t,0).toFixed(2)},totalAnuladas(){return this.compras.reduce((t,l)=>l.estado==="Anulado"?t+parseFloat(l.total):t,0).toFixed(2)}},methods:{proveedoresGet(){this.$axios.get("proveedores").then(t=>{this.proveedores=t.data})},excel(){const t=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:l=>`${l.fecha} ${l.hora}`},{label:"Proveedor",value:l=>{var u;return((u=l.proveedor)==null?void 0:u.nombre)||l.nombre||""}},{label:"Usuario",value:l=>{var u;return((u=l.user)==null?void 0:u.name)||""}},{label:"Estado",value:"estado"},{label:"Total (Bs)",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo de pago",value:"tipo_pago"},{label:"Factura",value:"nro_factura"}],content:this.compras}];U.export(t,`Compras_${this.fechaInicio}_a_${this.fechaFin}`)},comprasGet(){this.loading=!0,this.$axios.get("compras",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user,proveedor_id:this.proveedor_id}}).then(t=>{this.compras=t.data}).catch(t=>{var l,u;this.$alert.error(((u=(l=t.response)==null?void 0:l.data)==null?void 0:u.message)||"Error al obtener compras")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(t=>{console.log(t.data),this.users=t.data})},imprimir(t){Y.reciboCompra(t)},anular(t){this.$alert.dialog("\xBFAnular esta compra?").onOk(()=>{this.loading=!0,this.$axios.put(`comprasAnular/${t}`).then(()=>{this.$alert.success("Compra anulada"),this.comprasGet()})})}}},M={class:"row"},S={class:"col-12 col-md-4 q-pa-xs"},z={class:"col-12 col-md-4 q-pa-xs"},N={class:"col-12 col-md-4 q-pa-xs"},O={class:"row q-col-gutter-sm q-pa-sm"},L={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},X={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},j={class:"col-12 col-md-2"},K={class:"text-bold"},W={style:{"max-width":"200px","line-height":"1.1"}};function $(t,l,u,ee,i,c){return m(),b(Q,null,[e(G,{class:"q-pa-xs"},{default:a(()=>[o("div",M,[o("div",S,[e(v,{flat:"",bordered:""},{default:a(()=>[e(_,{class:"q-pa-none"},{default:a(()=>[e(f,{class:"bg-green"},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(h,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(n,null,{default:a(()=>[e(p,{caption:"",class:"text-white"},{default:a(()=>l[5]||(l[5]=[d("Compras Totales")])),_:1}),e(p,{class:"text-white text-h4"},{default:a(()=>[d(r(c.totalCompras)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",z,[e(v,{flat:"",bordered:""},{default:a(()=>[e(_,{class:"q-pa-none"},{default:a(()=>[e(f,{class:"bg-negative"},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(h,{name:"cancel",size:"50px",color:"white"})]),_:1}),e(n,null,{default:a(()=>[e(p,{caption:"",class:"text-white"},{default:a(()=>l[6]||(l[6]=[d("Compras Anuladas")])),_:1}),e(p,{class:"text-white text-h4"},{default:a(()=>[d(r(c.totalAnuladas)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",N,[e(v,{flat:"",bordered:""},{default:a(()=>[e(_,{class:"q-pa-none"},{default:a(()=>[e(f,{class:"bg-indigo"},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(h,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(n,null,{default:a(()=>[e(p,{caption:"",class:"text-white"},{default:a(()=>l[7]||(l[7]=[d("Total Compras")])),_:1}),e(p,{class:"text-white text-h4"},{default:a(()=>[d(r(i.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),e(v,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[e(_,{class:"q-pa-none"},{default:a(()=>[o("div",O,[o("div",L,[e(k,{modelValue:i.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>i.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",H,[e(k,{modelValue:i.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>i.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",J,[e(F,{modelValue:i.user,"onUpdate:modelValue":l[2]||(l[2]=s=>i.user=s),options:c.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",R,[e(F,{modelValue:i.proveedor_id,"onUpdate:modelValue":l[3]||(l[3]=s=>i.proveedor_id=s),options:c.proveedoresTodos,label:"Proveedor",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",X,[e(x,{color:"primary",label:"Buscar",icon:"search",onClick:c.comprasGet,loading:i.loading,"no-caps":""},null,8,["onClick","loading"])]),o("div",Z,[e(x,{color:"positive",label:"Compra",icon:"add_circle_outline",onClick:l[4]||(l[4]=s=>t.$router.push({name:"compras-create"})),"no-caps":"",loading:i.loading},null,8,["loading"])]),o("div",j,[e(x,{color:"primary",label:"Excel",icon:"file_download",onClick:c.excel,"no-caps":"",loading:i.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1}),e(E,{dense:"","wrap-cells":""},{default:a(()=>[l[10]||(l[10]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"ID"),o("th",null,"Fecha"),o("th",null,"Proveedor"),o("th",null,"Usuario"),o("th",null,"Estado"),o("th",null,"Total"),o("th",null,"Detalle"),o("th",null,"Pago")])],-1)),o("tbody",null,[(m(!0),b(Q,null,D(i.compras,s=>{var g,C;return m(),b("tr",{key:s.id},[o("td",null,[e(A,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:a(()=>[w((m(),I(f,{clickable:"",onClick:q=>c.imprimir(s)},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(h,{name:"print"})]),_:1}),e(n,null,{default:a(()=>l[8]||(l[8]=[d("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[V]]),w((m(),I(f,{clickable:"",onClick:q=>c.anular(s.id)},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(h,{name:"delete"})]),_:1}),e(n,null,{default:a(()=>l[9]||(l[9]=[d("Anular")])),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),o("td",null,r(s.id),1),o("td",null,r(s.fecha)+" "+r(s.hora),1),o("td",null,r((g=s.proveedor)==null?void 0:g.nombre),1),o("td",null,r((C=s.user)==null?void 0:C.name),1),o("td",null,[e(T,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:a(()=>[d(r(s.estado),1)]),_:2},1032,["color"])]),o("td",K,r(s.total)+" Bs",1),o("td",null,[o("div",W,r(s.detailsText),1)]),o("td",null,[e(T,{color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:a(()=>[d(r(s.tipo_pago),1)]),_:2},1032,["color"])])])}),128))])]),_:1})]),_:1}),l[11]||(l[11]=o("div",{id:"myElement",class:"hidden"},null,-1))],64)}var _e=B(P,[["render",$]]);export{_e as default};
