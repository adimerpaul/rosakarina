import{_ as Q,O as n,P as C,Q as i,R as s,aI as p,S as u,T as o,aG as g,$ as x,X as m,Y as y,Z as _,W as P,U as c,aH as b,aJ as k,V as q,J as U,bf as N}from"./index.441a13ee.js";import{Q as D}from"./QPagination.aaa15187.js";import{Q as w}from"./QImg.effdf14b.js";import{Q as G}from"./QMarkupTable.db478646.js";import{Q as V}from"./QForm.eddcae5f.js";import{Q as S}from"./QSpace.1f3c5873.js";import{Q as B}from"./QSelect.df2c9c69.js";import{Q as T}from"./QPage.96bccc7f.js";import"./format.2cae61da.js";import"./QChip.269e3a83.js";import"./QMenu.f5becda0.js";import"./QItemLabel.f6751363.js";const I={name:"PedidosCreate",data(){return{loading:!1,confirmDialog:!1,productos:[],search:"",pagination:{page:1,rowsPerPage:24,rowsNumber:0},items:[],proveedores:[],proveedor:null,telefono:"",observacion:""}},computed:{total(){const r=this.items.reduce((e,a)=>e+Number(a.cantidad||0)*Number(a.producto.precio||0),0);return Number(r).toFixed(2)}},mounted(){this.productosGet(),this.proveedoresGet()},methods:{productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.search,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(r=>{this.productos=r.data.data||r.data,this.pagination.rowsNumber=r.data.total||this.productos.length||0}).finally(()=>{this.loading=!1})},proveedoresGet(){this.$axios.get("proveedores").then(r=>{this.proveedores=r.data})},addProducto(r){const e=this.items.find(a=>a.producto_id===r.id);e?e.cantidad=Number(e.cantidad||0)+1:this.items.push({producto_id:r.id,cantidad:1,producto:r})},openConfirm(){if(this.items.length===0){this.$alert.error("Debe agregar al menos un producto");return}if(this.items.find(e=>Number(e.cantidad||0)<=0)){this.$alert.error("Todas las cantidades deben ser mayores a 0");return}this.confirmDialog=!0},syncProveedor(r){(r==null?void 0:r.telefono)&&!this.telefono&&(this.telefono=r.telefono)},submit(){var e;if(!((e=this.proveedor)!=null&&e.id))return;this.loading=!0;const r={proveedor_id:this.proveedor.id,telefono:this.telefono,observacion:this.observacion,productos:this.items.map(a=>({producto_id:a.producto_id,cantidad:a.cantidad}))};this.$axios.post("pedidos",r).then(()=>{this.$alert.success("Pedido registrado correctamente"),this.confirmDialog=!1,this.items=[],this.proveedor=null,this.telefono="",this.observacion="",this.productosGet(),this.$router.push({name:"pedidos"})}).catch(a=>{var f,l;console.error(a),this.$alert.error(((l=(f=a.response)==null?void 0:f.data)==null?void 0:l.message)||"Error al registrar pedido")}).finally(()=>{this.loading=!1})}}},F={class:"row"},M={class:"col-12 col-md-5 q-pa-xs"},j={class:"flex flex-center"},z={class:"row q-col-gutter-xs q-mt-xs"},A={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},E={style:{"max-width":"190px","line-height":"0.9"}},J={style:{display:"flex","justify-content":"space-between"}},O={class:"col-12 col-md-7 q-pa-xs"},R={class:"row items-center justify-between q-mb-xs"},W={style:{display:"flex","align-items":"center"}},H={style:{"max-width":"220px","line-height":"0.9"}},L=["onUpdate:modelValue"],X={key:0},Y={class:"text-right text-bold"},Z={class:"row q-col-gutter-sm"},K={class:"col-12"},$={class:"col-12"},ee={class:"col-12"};function oe(r,e,a,f,l,d){return n(),C(T,{class:"q-pa-xs"},{default:i(()=>[s(b,{flat:"",bordered:""},{default:i(()=>[s(p,{class:"row items-center q-pb-none"},{default:i(()=>[s(u,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:e[0]||(e[0]=t=>r.$router.back()),class:"q-mr-sm"}),e[9]||(e[9]=o("div",{class:"text-h6"},"Nuevo Pedido",-1))]),_:1}),s(p,{class:"q-pa-none"},{default:i(()=>[s(V,{onSubmit:d.openConfirm},{default:i(()=>[o("div",F,[o("div",M,[s(g,{modelValue:l.search,"onUpdate:modelValue":[e[1]||(e[1]=t=>l.search=t),d.productosGet],outlined:"",dense:"",debounce:"300",label:"Buscar producto",clearable:""},{append:i(()=>[s(x,{name:"search"})]),after:i(()=>[s(u,{flat:"",round:"",dense:"",icon:"refresh",onClick:d.productosGet},null,8,["onClick"])]),_:1},8,["modelValue","onUpdate:modelValue"]),o("div",j,[s(D,{modelValue:l.pagination.page,"onUpdate:modelValue":[e[2]||(e[2]=t=>l.pagination.page=t),d.productosGet],max:Math.ceil(l.pagination.rowsNumber/l.pagination.rowsPerPage),"max-pages":"5",size:"xs","boundary-numbers":"",class:"q-mt-sm"},null,8,["modelValue","max","onUpdate:modelValue"])]),o("div",z,[(n(!0),m(_,null,y(l.productos,t=>(n(),m("div",{class:"col-6 col-md-2",key:t.id},[s(b,{flat:"",bordered:"",class:"cursor-pointer",onClick:h=>d.addProducto(t)},{default:i(()=>[s(w,{src:`${r.$url}../images/${t.imagen}`,style:{height:"120px"}},{default:i(()=>[o("div",A,[o("div",E,c(r.$filters.textUpper(t.nombre)),1),o("div",J,[o("span",null,c(t.cantidad),1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),128))])]),o("div",O,[o("div",R,[o("div",null,[s(u,{size:"xs",flat:"",round:"",dense:"",icon:"delete",color:"red",onClick:e[3]||(e[3]=t=>l.items=[])}),e[10]||(e[10]=o("span",{class:"text-subtitle2 q-ml-sm"},"Productos seleccionados",-1))])]),s(G,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[e[13]||(e[13]=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",{style:{width:"90px"}},"Cantidad")])],-1)),o("tbody",null,[(n(!0),m(_,null,y(l.items,(t,h)=>(n(),m("tr",{key:h},[o("td",W,[s(w,{src:`${r.$url}../images/${t.producto.imagen}`,style:{height:"35px",width:"35px"},class:"q-mr-sm"},null,8,["src"]),o("div",H,[s(x,{name:"delete",color:"red",class:"cursor-pointer",onClick:v=>l.items.splice(h,1)},null,8,["onClick"]),q(" "+c(r.$filters.textUpper(t.producto.nombre)),1)])]),o("td",null,[U(o("input",{"onUpdate:modelValue":v=>t.cantidad=v,type:"number",min:"0",step:"0.01",style:{width:"80px"}},null,8,L),[[N,t.cantidad,void 0,{number:!0}]])])]))),128)),l.items.length===0?(n(),m("tr",X,e[11]||(e[11]=[o("td",{colspan:"4",class:"text-center text-grey q-pa-md"},"Agrega productos",-1)]))):P("",!0)]),o("tfoot",null,[o("tr",null,[e[12]||(e[12]=o("td",{colspan:"",class:"text-right text-bold"},"Total",-1)),o("td",Y,c(d.total)+" Bs",1)])])]),_:1}),s(u,{label:"Registrar pedido",color:"primary",class:"full-width q-mt-sm","no-caps":"",type:"submit",loading:l.loading,icon:"save"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),s(k,{modelValue:l.confirmDialog,"onUpdate:modelValue":e[8]||(e[8]=t=>l.confirmDialog=t)},{default:i(()=>[s(b,{style:{width:"520px","max-width":"90vw"}},{default:i(()=>[s(p,{class:"row items-center q-pb-none"},{default:i(()=>[e[14]||(e[14]=o("div",{class:"text-h6"},"Confirmar pedido",-1)),s(S),s(u,{flat:"",round:"",dense:"",icon:"close",onClick:e[4]||(e[4]=t=>l.confirmDialog=!1)})]),_:1}),s(p,null,{default:i(()=>[s(V,{onSubmit:d.submit},{default:i(()=>[o("div",Z,[o("div",K,[s(B,{modelValue:l.proveedor,"onUpdate:modelValue":[e[5]||(e[5]=t=>l.proveedor=t),d.syncProveedor],options:l.proveedores,"option-label":"nombre","option-value":"id",dense:"",outlined:"",label:"Proveedor",rules:[t=>!!t||"Campo requerido"]},null,8,["modelValue","options","rules","onUpdate:modelValue"])]),o("div",$,[s(g,{modelValue:l.telefono,"onUpdate:modelValue":e[6]||(e[6]=t=>l.telefono=t),dense:"",outlined:"",label:"Tel\xE9fono (WhatsApp)"},null,8,["modelValue"])]),o("div",ee,[s(g,{modelValue:l.observacion,"onUpdate:modelValue":e[7]||(e[7]=t=>l.observacion=t),type:"textarea",autogrow:"",dense:"",outlined:"",label:"Observaci\xF3n (opcional)"},null,8,["modelValue"])])]),s(u,{label:"Guardar",color:"primary",class:"full-width q-mt-md",type:"submit","no-caps":"",icon:"save",loading:l.loading},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var fe=Q(I,[["render",oe]]);export{fe as default};
