import{_ as F,O as m,P as x,Q as s,T as o,R as e,$ as f,V as u,U as i,aH as g,aI as T,aG as k,S as V,X as w,Y as A,Z as D,W as S,J as C}from"./index.05ec8a00.js";import{a as v,b as r}from"./QMenu.20988a0c.js";import{Q as p}from"./QItemLabel.be1b8919.js";import{Q as y}from"./QSelect.0e926958.js";import{Q as B}from"./QBtnDropdown.42d141fb.js";import{Q as G}from"./QChip.8cb0ba17.js";import{Q as Y}from"./QMarkupTable.60ba416e.js";import{Q as N}from"./QPage.25b4f3bb.js";import{C as I}from"./ClosePopup.cd1cf7f0.js";import{h as P}from"./moment.40bc58bf.js";import"./format.2cae61da.js";import"./QBtnGroup.5b18e740.js";const U={name:"Pedidos",data(){return{pedidos:[],fechaInicio:P().format("YYYY-MM-DD"),fechaFin:P().format("YYYY-MM-DD"),user:"",users:[],proveedor_id:"",proveedores:[],loading:!1}},mounted(){this.pedidosGet(),this.usersGet(),this.proveedoresGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(l=>({label:l.name,value:l.id}))]},proveedoresTodos(){return[{label:"Todos",value:""},...this.proveedores.map(l=>({label:l.nombre,value:l.id}))]},totalSubtotal(){return this.pedidos.reduce((l,t)=>t.estado==="Activo"?l+Number(t.subtotal||0):l,0).toFixed(2)},totalAnulados(){return this.pedidos.reduce((l,t)=>t.estado==="Anulado"?l+Number(t.subtotal||0):l,0).toFixed(2)}},methods:{pedidosGet(){this.loading=!0,this.$axios.get("pedidos",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user,proveedor_id:this.proveedor_id}}).then(l=>{this.pedidos=l.data}).catch(l=>{var t,h;this.$alert.error(((h=(t=l.response)==null?void 0:t.data)==null?void 0:h.message)||"Error al obtener pedidos")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(l=>{this.users=l.data})},proveedoresGet(){this.$axios.get("proveedores").then(l=>{this.proveedores=l.data})},anular(l){this.$alert.dialog("\xBFAnular este pedido?").onOk(()=>{this.loading=!0,this.$axios.put(`pedidosAnular/${l}`).then(()=>{this.$alert.success("Pedido anulado"),this.pedidosGet()}).finally(()=>{this.loading=!1})})},whatsapp(l){var a;const t=String(l.telefono||"").replace(/\D/g,"");if(!t){this.$alert.error("Este pedido no tiene tel\xE9fono");return}const h=((a=l.proveedor)==null?void 0:a.nombre)||l.proveedor_nombre||"",Q=(l.detalles||[]).filter(c=>Number(c.cantidad||0)>0).map(c=>{var b;const _=c.nombre||((b=c.producto)==null?void 0:b.nombre)||"Producto";return`${c.cantidad} - ${_}`}).join(`
`),d=`Hola ${h}.
Pedido #${l.id} (${l.fecha}).
Detalle:
${Q}`,n=`https://wa.me/${t}?text=${encodeURIComponent(d)}`;window.open(n,"_blank")}}},q={class:"row q-col-gutter-sm"},$={class:"col-12 col-md-4"},E={class:"col-12 col-md-4"},M={class:"col-12 col-md-4"},z={class:"row q-col-gutter-sm items-end"},L={class:"col-12 col-md-2"},O={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},W={class:"col-12 col-md-2"},j={class:"col-12 col-md-2"},J={class:"text-bold"},X={style:{"max-width":"240px","line-height":"1.1"}},Z={key:0};function K(l,t,h,Q,d,n){return m(),x(N,{class:"q-pa-xs"},{default:s(()=>[o("div",q,[o("div",$,[e(g,{flat:"",bordered:""},{default:s(()=>[e(v,{class:"bg-indigo text-white"},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(f,{name:"shopping_cart",size:"40px"})]),_:1}),e(r,null,{default:s(()=>[e(p,{caption:"",class:"text-white"},{default:s(()=>t[5]||(t[5]=[u("Subtotal Pedidos")])),_:1}),e(p,{class:"text-h5 text-weight-bold"},{default:s(()=>[u(i(n.totalSubtotal)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",E,[e(g,{flat:"",bordered:""},{default:s(()=>[e(v,{class:"bg-negative text-white"},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(f,{name:"cancel",size:"40px"})]),_:1}),e(r,null,{default:s(()=>[e(p,{caption:"",class:"text-white"},{default:s(()=>t[6]||(t[6]=[u("Anulados")])),_:1}),e(p,{class:"text-h5 text-weight-bold"},{default:s(()=>[u(i(n.totalAnulados)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",M,[e(g,{flat:"",bordered:""},{default:s(()=>[e(v,{class:"bg-green text-white"},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(f,{name:"receipt_long",size:"40px"})]),_:1}),e(r,null,{default:s(()=>[e(p,{caption:"",class:"text-white"},{default:s(()=>t[7]||(t[7]=[u("Total Pedidos")])),_:1}),e(p,{class:"text-h5 text-weight-bold"},{default:s(()=>[u(i(d.pedidos.length),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),e(g,{flat:"",bordered:"",class:"q-mt-sm"},{default:s(()=>[e(T,{class:"q-pa-sm"},{default:s(()=>[o("div",z,[o("div",L,[e(k,{modelValue:d.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=a=>d.fechaInicio=a),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",O,[e(k,{modelValue:d.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=a=>d.fechaFin=a),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",H,[e(y,{modelValue:d.user,"onUpdate:modelValue":t[2]||(t[2]=a=>d.user=a),options:n.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",R,[e(y,{modelValue:d.proveedor_id,"onUpdate:modelValue":t[3]||(t[3]=a=>d.proveedor_id=a),options:n.proveedoresTodos,label:"Proveedor",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",W,[e(V,{color:"primary",label:"Buscar",icon:"search","no-caps":"",loading:d.loading,onClick:n.pedidosGet},null,8,["loading","onClick"])]),o("div",j,[e(V,{color:"positive",label:"Pedido",icon:"add_circle_outline","no-caps":"",onClick:t[4]||(t[4]=a=>l.$router.push({name:"pedidos-create"}))})])])]),_:1})]),_:1}),e(Y,{dense:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[t[11]||(t[11]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"ID"),o("th",null,"Fecha"),o("th",null,"Proveedor"),o("th",null,"Tel\xE9fono"),o("th",null,"Usuario"),o("th",null,"Estado"),o("th",null,"Subtotal"),o("th",null,"Detalle")])],-1)),o("tbody",null,[(m(!0),w(D,null,A(d.pedidos,a=>{var c,_;return m(),w("tr",{key:a.id},[o("td",null,[e(B,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:s(()=>[C((m(),x(v,{clickable:"",onClick:b=>n.whatsapp(a)},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(f,{name:"phone",color:"green"})]),_:1}),e(r,null,{default:s(()=>t[8]||(t[8]=[u("Enviar WhatsApp")])),_:1})]),_:2},1032,["onClick"])),[[I]]),C((m(),x(v,{clickable:"",onClick:b=>n.anular(a.id)},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(f,{name:"delete"})]),_:1}),e(r,null,{default:s(()=>t[9]||(t[9]=[u("Anular")])),_:1})]),_:2},1032,["onClick"])),[[I]])]),_:2},1024)]),o("td",null,i(a.id),1),o("td",null,i(a.fecha)+" "+i(a.hora),1),o("td",null,i(((c=a.proveedor)==null?void 0:c.nombre)||a.proveedor_nombre||"-"),1),o("td",null,i(a.telefono||"-"),1),o("td",null,i(((_=a.user)==null?void 0:_.name)||"-"),1),o("td",null,[e(G,{color:a.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:s(()=>[u(i(a.estado),1)]),_:2},1032,["color"])]),o("td",J,i(Number(a.subtotal||0).toFixed(2))+" Bs",1),o("td",null,[o("div",X,i(a.detailsText),1)])])}),128)),!d.loading&&d.pedidos.length===0?(m(),w("tr",Z,t[10]||(t[10]=[o("td",{colspan:"9",class:"text-center text-grey q-pa-md"},"Sin pedidos",-1)]))):S("",!0)])]),_:1})]),_:1})}var me=F(U,[["render",K]]);export{me as default};
