import{_ as A,O as m,X as h,R as e,Q as a,T as t,Z as x,aH as b,aI as g,$ as f,V as n,U as r,aG as w,S as C,Y as I,J as F,P as V}from"./index.f5457207.js";import{Q as v,a as u}from"./QItem.f9bf5b17.js";import{Q as _}from"./QItemLabel.ab17f4fc.js";import{Q as T}from"./QSelect.97904e01.js";import{Q as E}from"./QBtnDropdown.8d1780b4.js";import{Q as B}from"./QChip.600a6998.js";import{Q as G}from"./QMarkupTable.8a6b74ab.js";import{Q as Y}from"./QPage.562334ad.js";import{C as D}from"./ClosePopup.acab7d70.js";import{h as q}from"./moment.40bc58bf.js";import{I as P}from"./Imprimir.d53de970.js";import{E as U}from"./Excel.a5e16faf.js";import"./QMenu.8fa6cab6.js";import"./format.2cae61da.js";import"./QBtnGroup.a996d5ee.js";import"./numeroaletras.735f6b36.js";import"./_commonjsHelpers.a26ce4be.js";const S={data(){return{compras:[],fechaInicio:q().format("YYYY-MM-DD"),fechaFin:q().format("YYYY-MM-DD"),user:"",users:[],proveedor_id:"",proveedores:[],loading:!1}},mounted(){this.comprasGet(),this.usersGet(),this.proveedoresGet()},computed:{proveedoresTodos(){return[{label:"Todos",value:""},...this.proveedores.map(o=>({label:o.nombre,value:o.id}))]},usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalCompras(){return this.compras.reduce((o,l)=>l.estado==="Activo"?o+parseFloat(l.total):o,0).toFixed(2)},totalAnuladas(){return this.compras.reduce((o,l)=>l.estado==="Anulado"?o+parseFloat(l.total):o,0).toFixed(2)}},methods:{detallesCompra(o){return o.compra_detalles||o.compraDetalles||[]},formatBs(o){return Number(o||0).toFixed(2)},proveedoresGet(){this.$axios.get("proveedores").then(o=>{this.proveedores=o.data})},excel(){const o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:l=>`${l.fecha} ${l.hora}`},{label:"Proveedor",value:l=>{var c;return((c=l.proveedor)==null?void 0:c.nombre)||l.nombre||""}},{label:"Usuario",value:l=>{var c;return((c=l.user)==null?void 0:c.name)||""}},{label:"Estado",value:"estado"},{label:"Total (Bs)",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo de pago",value:"tipo_pago"},{label:"Factura",value:"nro_factura"}],content:this.compras}];U.export(o,`Compras_${this.fechaInicio}_a_${this.fechaFin}`)},comprasGet(){this.loading=!0,this.$axios.get("compras",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user,proveedor_id:this.proveedor_id}}).then(o=>{this.compras=o.data}).catch(o=>{var l,c;this.$alert.error(((c=(l=o.response)==null?void 0:l.data)==null?void 0:c.message)||"Error al obtener compras")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(o=>{console.log(o.data),this.users=o.data})},imprimir(o){P.reciboCompra(o)},anular(o){this.$alert.dialog("\xBFAnular esta compra?").onOk(()=>{this.loading=!0,this.$axios.put(`comprasAnular/${o}`).then(()=>{this.$alert.success("Compra anulada"),this.comprasGet()})})}}},M={class:"row"},z={class:"col-12 col-md-4 q-pa-xs"},N={class:"col-12 col-md-4 q-pa-xs"},O={class:"col-12 col-md-4 q-pa-xs"},L={class:"row q-col-gutter-sm q-pa-sm"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},X={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},j={class:"col-12 col-md-2"},K={class:"col-12 col-md-2"},W={class:"text-bold"},$={class:"detalle-wrap"},ee={key:0,class:"detalle-list"},le={class:"detalle-nombre"},te={class:"detalle-precio"},ae={key:1,class:"text-grey-6"};function oe(o,l,c,se,i,d){return m(),h(x,null,[e(Y,{class:"q-pa-xs"},{default:a(()=>[t("div",M,[t("div",z,[e(b,{flat:"",bordered:""},{default:a(()=>[e(g,{class:"q-pa-none"},{default:a(()=>[e(v,{class:"bg-green"},{default:a(()=>[e(u,{avatar:""},{default:a(()=>[e(f,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(u,null,{default:a(()=>[e(_,{caption:"",class:"text-white"},{default:a(()=>l[5]||(l[5]=[n("Compras Totales")])),_:1}),e(_,{class:"text-white text-h4"},{default:a(()=>[n(r(d.totalCompras)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",N,[e(b,{flat:"",bordered:""},{default:a(()=>[e(g,{class:"q-pa-none"},{default:a(()=>[e(v,{class:"bg-negative"},{default:a(()=>[e(u,{avatar:""},{default:a(()=>[e(f,{name:"cancel",size:"50px",color:"white"})]),_:1}),e(u,null,{default:a(()=>[e(_,{caption:"",class:"text-white"},{default:a(()=>l[6]||(l[6]=[n("Compras Anuladas")])),_:1}),e(_,{class:"text-white text-h4"},{default:a(()=>[n(r(d.totalAnuladas)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",O,[e(b,{flat:"",bordered:""},{default:a(()=>[e(g,{class:"q-pa-none"},{default:a(()=>[e(v,{class:"bg-indigo"},{default:a(()=>[e(u,{avatar:""},{default:a(()=>[e(f,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(u,null,{default:a(()=>[e(_,{caption:"",class:"text-white"},{default:a(()=>l[7]||(l[7]=[n("Total Compras")])),_:1}),e(_,{class:"text-white text-h4"},{default:a(()=>[n(r(i.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),e(b,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[e(g,{class:"q-pa-none"},{default:a(()=>[t("div",L,[t("div",H,[e(w,{modelValue:i.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>i.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",J,[e(w,{modelValue:i.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>i.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",R,[e(T,{modelValue:i.user,"onUpdate:modelValue":l[2]||(l[2]=s=>i.user=s),options:d.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",X,[e(T,{modelValue:i.proveedor_id,"onUpdate:modelValue":l[3]||(l[3]=s=>i.proveedor_id=s),options:d.proveedoresTodos,label:"Proveedor",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",Z,[e(C,{color:"primary",label:"Buscar",icon:"search",onClick:d.comprasGet,loading:i.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",j,[e(C,{color:"positive",label:"Compra",icon:"add_circle_outline",onClick:l[4]||(l[4]=s=>o.$router.push({name:"compras-create"})),"no-caps":"",loading:i.loading},null,8,["loading"])]),t("div",K,[e(C,{color:"primary",label:"Excel",icon:"file_download",onClick:d.excel,"no-caps":"",loading:i.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1}),e(G,{dense:"","wrap-cells":""},{default:a(()=>[l[10]||(l[10]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Acciones"),t("th",null,"ID"),t("th",null,"Fecha"),t("th",null,"Proveedor"),t("th",null,"Usuario"),t("th",null,"Estado"),t("th",null,"Total"),t("th",null,"Detalle"),t("th",null,"Pago")])],-1)),t("tbody",null,[(m(!0),h(x,null,I(i.compras,s=>{var k,Q;return m(),h("tr",{key:s.id},[t("td",null,[e(E,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:a(()=>[F((m(),V(v,{clickable:"",onClick:p=>d.imprimir(s)},{default:a(()=>[e(u,{avatar:""},{default:a(()=>[e(f,{name:"print"})]),_:1}),e(u,null,{default:a(()=>l[8]||(l[8]=[n("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[D]]),F((m(),V(v,{clickable:"",onClick:p=>d.anular(s.id)},{default:a(()=>[e(u,{avatar:""},{default:a(()=>[e(f,{name:"delete"})]),_:1}),e(u,null,{default:a(()=>l[9]||(l[9]=[n("Anular")])),_:1})]),_:2},1032,["onClick"])),[[D]])]),_:2},1024)]),t("td",null,r(s.id),1),t("td",null,r(s.fecha)+" "+r(s.hora),1),t("td",null,r((k=s.proveedor)==null?void 0:k.nombre),1),t("td",null,r((Q=s.user)==null?void 0:Q.name),1),t("td",null,[e(B,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:a(()=>[n(r(s.estado),1)]),_:2},1032,["color"])]),t("td",W,r(s.total)+" Bs",1),t("td",null,[t("div",$,[d.detallesCompra(s).length?(m(),h("ul",ee,[(m(!0),h(x,null,I(d.detallesCompra(s),p=>{var y;return m(),h("li",{key:p.id||`${s.id}-${p.producto_id}-${p.lote||"sin-lote"}`,class:"detalle-item"},[t("span",le,r(p.cantidad)+" x "+r(p.nombre||((y=p.producto)==null?void 0:y.nombre)||"Producto"),1),t("span",te,r(d.formatBs(p.precio))+" Bs",1)])}),128))])):(m(),h("span",ae,"Sin detalle"))])]),t("td",null,[e(B,{color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:a(()=>[n(r(s.tipo_pago),1)]),_:2},1032,["color"])])])}),128))])]),_:1})]),_:1}),l[11]||(l[11]=t("div",{id:"myElement",class:"hidden"},null,-1))],64)}var Qe=A(S,[["render",oe],["__scopeId","data-v-1ab4b5d4"]]);export{Qe as default};
