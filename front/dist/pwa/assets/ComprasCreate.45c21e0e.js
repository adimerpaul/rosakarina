import{_ as N,O as u,P as Q,Q as a,R as r,aI as v,T as e,S as m,aG as h,X as b,Y as C,Z as V,U as p,aH as w,bb as I,aJ as U,$ as E,V as S,J as g,bf as f,a2 as G}from"./index.f5457207.js";import{Q as T}from"./QPagination.906cbbff.js";import{Q as P}from"./QImg.bb273513.js";import{Q as q}from"./QMarkupTable.8a6b74ab.js";import{Q as D}from"./QForm.643e130b.js";import{Q as k}from"./QSpace.6a7bd18c.js";import{Q as F}from"./QSelect.97904e01.js";import{Q as M}from"./QPage.562334ad.js";import{I as B}from"./Imprimir.d53de970.js";import"./format.2cae61da.js";import"./QChip.600a6998.js";import"./QItem.f9bf5b17.js";import"./QItemLabel.ab17f4fc.js";import"./QMenu.8fa6cab6.js";import"./numeroaletras.735f6b36.js";import"./moment.40bc58bf.js";const R={name:"ComprasCreate",data(){return{proveedorDialog:!1,formProveedorRef:null,proveedorForm:{nombre:"",ci:"",telefono:"",email:"",direccion:""},loading:!1,compraDialog:!1,productos:[],productosSearch:"",productosCompras:[],proveedores:[],proveedor:null,compra:{nit:"",nombre:"",tipo_pago:"Efectivo"},pagination:{page:1,rowsPerPage:24,rowsNumber:0}}},computed:{totalCompra(){let s=0;return this.productosCompras.forEach(o=>{s+=o.cantidad*o.precio}),parseFloat(s).toFixed(2)}},methods:{openProveedorDialog(){this.resetProveedorForm(),this.proveedorDialog=!0},closeProveedorDialog(){this.proveedorDialog=!1},resetProveedorForm(){this.proveedorForm={nombre:"",ci:"",telefono:"",email:"",direccion:""}},async saveProveedor(){!await this.$refs.formProveedorRef.validate()||(this.loading=!0,this.$axios.post("proveedores",this.proveedorForm).then(o=>{var c,l;const n=o.data;this.proveedores.unshift(n),this.proveedor=n,this.compra.nombre=n.nombre||"",this.compra.ci=n.ci||"",(l=(c=this.$alert)==null?void 0:c.success)!=null&&l.call(c,"Proveedor creado correctamente")||this.$q.notify({type:"positive",message:"Proveedor creado correctamente"}),this.proveedorDialog=!1,this.resetProveedorForm()}).catch(o=>{var n,c;console.error("Error creando proveedor:",o),(c=(n=this.$alert)==null?void 0:n.error)!=null&&c.call(n,"No se pudo crear el proveedor")||this.$q.notify({type:"negative",message:"No se pudo crear el proveedor"})}).finally(()=>{this.loading=!1}))},onCantidadChange(s){const o=Number(s.cantidad)||0,n=Number(s.precio)||0;s.total=this.round2(o*n),this.updatePrecioVenta(s)},onPrecioChange(s){const o=Number(s.cantidad)||0,n=Number(s.precio)||0;s.total=this.round2(o*n),this.updatePrecioVenta(s)},onTotalChange(s){const o=Number(s.cantidad)||0,n=Number(s.total)||0;s.precio=o>0?this.round3(n/o):0,this.updatePrecioVenta(s)},onFactorChange(s){this.updatePrecioVenta(s)},updatePrecioVenta(s){const o=Number(s.precio)||0,n=Number(s.factor)||0;s.precio_venta=this.round2(o*n)},round2(s){return Math.round((Number(s)||0)*100)/100},round3(s){return Math.round((Number(s)||0)*1e3)/1e3},recuperarPedido(){this.$q.dialog({title:"Recuperar pedido",message:"Ingrese el ID del pedido",prompt:{model:"",type:"text",isValid:s=>!!s||"Campo requerido"},persistent:!0,cancel:!0,ok:{label:"Recuperar",color:"primary"}}).onOk(s=>{this.loading=!0,this.$axios.get("recuperarPedido",{params:{id:s}}).then(o=>{if(!o.data.detalles||o.data.detalles.length===0){this.$alert.error("No se encontraron productos en el pedido");return}o.data.detalles.forEach(n=>{const c=n.producto,l=this.productosCompras.find(i=>i.producto_id===c.id);l?l.cantidad+=1:this.productosCompras.push({producto_id:c.id,cantidad:parseInt(n.cantidad),precio:"",lote:"",fecha_vencimiento:"",producto:c,factor:1.25})})}).catch(o=>{console.error("Error recuperando pedido:",o)}).finally(()=>{this.loading=!1})})},updatePrecioVenta(s){const o=Math.ceil(s.precio*s.factor);s.precio_venta=o},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(s=>{this.productos=s.data.data,this.pagination.rowsNumber=s.data.total}).catch(s=>{console.error("Error cargando productos:",s)}).finally(()=>{this.loading=!1})},addProducto(s){this.productosCompras.push({producto_id:s.id,cantidad:1,precio:"",lote:"",fecha_vencimiento:"",producto:s,factor:1.25})},clickDialogCompra(){if(this.productosCompras.length===0){this.$alert.error("Debe agregar al menos un producto");return}this.compraDialog=!0},buscarProveedor(){!this.compra.nit||(this.loading=!0,this.$axios.post("searchProveedor",{nit:this.compra.nit}).then(s=>{var o;(o=s.data)!=null&&o.nombre&&(this.compra.nombre=s.data.nombre)}).catch(s=>{console.warn("Proveedor no encontrado",s)}).finally(()=>{this.loading=!1}))},submitCompra(){this.loading=!0;const s={tipo_pago:this.compra.tipo_pago,proveedor_id:this.proveedor.id,nro_factura:this.compra.nro_factura,productos:this.productosCompras,agencia:this.compra.agencia};this.$axios.post("compras",s).then(o=>{this.$alert.success("Compra registrada correctamente"),this.compraDialog=!1,this.productosCompras=[],B.reciboCompra(o.data),this.productosGet(),this.compra={nit:"",nombre:"",tipo_pago:"Efectivo"},this.proveedor=null}).catch(o=>{console.error("Error registrando compra:",o),this.$alert.error("Error al registrar la compra")}).finally(()=>{this.loading=!1})},proveedoresGet(){this.$axios.get("proveedores").then(s=>{this.proveedores=s.data}).catch(s=>{console.error("Error cargando proveedores:",s)}).finally(()=>{})}},mounted(){this.productosGet(),this.proveedoresGet()}},z={class:"row"},L={class:"col-12 col-md-5 q-pa-xs"},j={class:"flex flex-center"},J={class:"row"},O={class:"col-6 col-md-2"},H={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},X={style:{"max-width":"190px","line-height":"0.9"}},Y={style:{display:"flex","justify-content":"space-between"}},Z={class:"text-bold bg-orange text-black border"},A={class:"col-12 col-md-7 q-pa-xs"},K={style:{display:"flex","align-items":"center","justify-content":"space-between"}},W={class:"pm-none",style:{display:"flex","align-items":"center"}},$={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},ee={class:"pm-none"},oe=["onUpdate:modelValue","onInput"],te={class:"pm-none"},se=["onUpdate:modelValue","onInput"],re={class:"text-right pm-none"},le=["onUpdate:modelValue","onInput"],ae={class:"pm-none"},ne=["onUpdate:modelValue","onInput"],ie={class:"text-right pm-none text-bold"},de={class:"text-right pm-none"},pe={class:"pm-none"},ce=["onUpdate:modelValue"],me={class:"pm-none"},ue=["onUpdate:modelValue"],he={class:"pm-none"},ge=["onUpdate:modelValue"],fe={class:"pm-none text-right"},ve={class:"text-right"},be={class:"row"},xe={class:"col-12 col-md-6 q-pa-xs"},_e={class:"col-12 col-md-6 q-pa-xs"},ye={class:"col-12 col-md-6 q-pa-xs"},we={class:"col-12"},Ce={class:"pm-none",style:{display:"flex","align-items":"center"}},Ve={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},Pe={class:"pm-none"},De={class:"pm-none text-red text-bold text-right"},ke={class:"pm-none"},Ue={class:"pm-none"},qe={class:"row q-col-gutter-sm"},Fe={class:"col-12"},Ne={class:"col-12 col-md-6"},Qe={class:"col-12 col-md-6"},Ie={class:"col-12"},Ee={class:"col-12"},Se={class:"row q-gutter-sm q-mt-md"};function Ge(s,o,n,c,l,i){return u(),Q(M,{class:"q-pa-xs"},{default:a(()=>[r(w,{flat:"",bordered:""},{default:a(()=>[r(v,{class:"row items-center q-pb-none"},{default:a(()=>[o[16]||(o[16]=e("div",{class:"text-h6"},"Compras",-1)),r(m,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:o[0]||(o[0]=t=>s.$router.back()),class:"q-mr-sm"})]),_:1}),r(v,{class:"q-pa-none"},{default:a(()=>[r(D,{onSubmit:i.clickDialogCompra},{default:a(()=>[e("div",z,[e("div",L,[r(h,{modelValue:l.productosSearch,"onUpdate:modelValue":[o[1]||(o[1]=t=>l.productosSearch=t),i.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:a(()=>[r(m,{flat:"",round:"",dense:"",icon:"search"})]),after:a(()=>[r(m,{flat:"",round:"",dense:"",icon:"refresh",onClick:i.productosGet},null,8,["onClick"])]),_:1},8,["modelValue","onUpdate:modelValue"]),e("div",j,[r(T,{modelValue:l.pagination.page,"onUpdate:modelValue":[o[2]||(o[2]=t=>l.pagination.page=t),i.productosGet],max:Math.ceil(l.pagination.rowsNumber/l.pagination.rowsPerPage),"max-pages":"5",size:"xs","boundary-numbers":"",class:"q-mt-sm"},null,8,["modelValue","max","onUpdate:modelValue"])]),e("div",J,[(u(!0),b(V,null,C(l.productos,t=>(u(),b("div",O,[r(w,{flat:"",bordered:"",class:"cursor-pointer",onClick:x=>i.addProducto(t)},{default:a(()=>[r(P,{src:`${s.$url}../images/${t.imagen}`,class:"q-mb-xs",style:{height:"120px"}},{default:a(()=>[e("div",H,[e("div",X,p(s.$filters.textUpper(t.nombre)),1),e("div",Y,[e("span",null,p(t.cantidad),1),e("span",Z,p(t.precio)+" Bs",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),256))])]),e("div",A,[e("div",K,[e("span",null,[r(m,{size:"xs",flat:"",round:"",dense:"",icon:"delete",color:"red",onClick:o[3]||(o[3]=t=>l.productosCompras=[]),class:"q-mb-sm"}),o[17]||(o[17]=e("span",{class:"text-subtitle2"},"Productos seleccionados",-1))]),e("span",null,[r(m,{size:"xs",dense:"",icon:"restore",color:"blue",class:"q-mb-sm",label:"Recuperar pedidos","no-caps":"",onClick:i.recuperarPedido},null,8,["onClick"])])]),r(q,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[o[19]||(o[19]=e("thead",null,[e("tr",null,[e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Producto"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Cantidad"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Precio factura"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Total"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Factor"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Precio unitario 1.25"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Total"),e("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Lote"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Fecha vencimiento"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Dias vencimiento")])],-1)),e("tbody",null,[(u(!0),b(V,null,C(l.productosCompras,(t,x)=>{var _,y;return u(),b("tr",{key:x},[e("td",W,[r(P,{src:`${s.$url}../images/${(_=t.producto)==null?void 0:_.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",$,[r(E,{name:"delete",color:"red",class:"cursor-pointer",onClick:d=>l.productosCompras.splice(x,1)},null,8,["onClick"]),S(" "+p(s.$filters.textUpper((y=t.producto)==null?void 0:y.nombre)),1)])]),e("td",ee,[g(e("input",{"onUpdate:modelValue":d=>t.cantidad=d,type:"number",min:"0",style:{width:"60px"},onInput:d=>i.onCantidadChange(t)},null,40,oe),[[f,t.cantidad,void 0,{number:!0}]])]),e("td",te,[g(e("input",{"onUpdate:modelValue":d=>t.precio=d,type:"number",min:"0",step:"0.001",style:{width:"70px"},onInput:d=>i.onPrecioChange(t)},null,40,se),[[f,t.precio,void 0,{number:!0}]])]),e("td",re,[g(e("input",{"onUpdate:modelValue":d=>t.total=d,type:"number",min:"0",step:"0.001",style:{width:"70px"},onInput:d=>i.onTotalChange(t)},null,40,le),[[f,t.total,void 0,{number:!0}]])]),e("td",ae,[g(e("input",{"onUpdate:modelValue":d=>t.factor=d,type:"number",min:"0",step:"0.001",style:{width:"60px"},onInput:d=>i.onFactorChange(t)},null,40,ne),[[f,t.factor,void 0,{number:!0}]])]),e("td",ie,p(parseFloat(t.precio*t.factor).toFixed(2)),1),e("td",de,p(parseFloat(t.cantidad*t.precio*t.factor).toFixed(2)),1),e("td",pe,[g(e("input",{"onUpdate:modelValue":d=>t.precio_venta=d,type:"number",style:{width:"55px",color:"red","font-weight":"bold"},step:"0.01"},null,8,ce),[[f,t.precio_venta]])]),e("td",me,[g(e("input",{"onUpdate:modelValue":d=>t.lote=d,type:"text",style:{width:"70px"}},null,8,ue),[[f,t.lote]])]),e("td",he,[g(e("input",{"onUpdate:modelValue":d=>t.fecha_vencimiento=d,type:"date",style:{width:"100px"}},null,8,ge),[[f,t.fecha_vencimiento]])]),e("td",fe,[e("span",{class:G(`text-bold ${new Date(t.fecha_vencimiento)-new Date<0||Math.ceil((new Date(t.fecha_vencimiento)-new Date)/(1e3*60*60*24))<30?"text-red":Math.ceil((new Date(t.fecha_vencimiento)-new Date)/(1e3*60*60*24))<60?"text-orange":"text-green"}`)},p(t.fecha_vencimiento?Math.ceil((new Date(t.fecha_vencimiento)-new Date)/(1e3*60*60*24)):""),3)])])}),128))]),e("tfoot",null,[e("tr",null,[o[18]||(o[18]=e("td",{colspan:"3",class:"text-right"},"Total",-1)),e("td",ve,p(i.totalCompra)+" Bs",1)])])]),_:1}),r(m,{label:"Registrar compra",color:"primary",class:"full-width","no-caps":"",loading:l.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),r(U,{modelValue:l.compraDialog,"onUpdate:modelValue":o[9]||(o[9]=t=>l.compraDialog=t)},{default:a(()=>[r(w,{style:{width:"600px"}},{default:a(()=>[r(v,{class:"row items-center q-pb-none"},{default:a(()=>[o[20]||(o[20]=e("div",{class:"text-h6"},"Confirmar compra",-1)),r(k),r(m,{flat:"",round:"",dense:"",icon:"close",onClick:o[4]||(o[4]=t=>l.compraDialog=!1)})]),_:1}),r(v,null,{default:a(()=>[r(D,{onSubmit:i.submitCompra},{default:a(()=>[e("div",be,[e("div",xe,[r(F,{modelValue:l.proveedor,"onUpdate:modelValue":[o[5]||(o[5]=t=>l.proveedor=t),o[6]||(o[6]=t=>{t?(this.compra.nombre=t.nombre||"",this.compra.ci=t.ci||""):(this.compra.nombre="",this.compra.ci="")})],options:l.proveedores,"option-label":"nombre","option-value":"id",label:"Proveedor",dense:"",outlined:"",rules:[t=>!!t||"Campo requerido"]},{append:a(()=>[r(m,{round:"",dense:"",flat:"",icon:"person_add",onClick:I(i.openProveedorDialog,["stop"]),title:"Nuevo proveedor"},null,8,["onClick"])]),_:1},8,["modelValue","options","rules"])]),e("div",_e,[r(F,{modelValue:l.compra.tipo_pago,"onUpdate:modelValue":o[7]||(o[7]=t=>l.compra.tipo_pago=t),options:["Efectivo","QR"],label:"Tipo de pago",dense:"",outlined:""},null,8,["modelValue"])]),e("div",ye,[r(h,{modelValue:l.compra.nro_factura,"onUpdate:modelValue":o[8]||(o[8]=t=>l.compra.nro_factura=t),outlined:"",dense:"",label:"Nro. factura"},null,8,["modelValue"])]),e("div",we,[r(q,{flat:"",dense:"","wrap-cells":"",bordered:""},{default:a(()=>[o[21]||(o[21]=e("thead",null,[e("tr",null,[e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Producto"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Cantidad"),e("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Lote"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Fecha vencimiento")])],-1)),e("tbody",null,[(u(!0),b(V,null,C(l.productosCompras,(t,x)=>{var _,y;return u(),b("tr",{key:x},[e("td",Ce,[r(P,{src:`${s.$url}../images/${(_=t.producto)==null?void 0:_.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",Ve,p(s.$filters.textUpper((y=t.producto)==null?void 0:y.nombre)),1)]),e("td",Pe,p(t.cantidad),1),e("td",De,p(t.precio_venta)+" Bs ",1),e("td",ke,p(t.lote),1),e("td",Ue,p(t.fecha_vencimiento),1)])}),128))])]),_:1})])]),r(m,{label:"Guardar compra",color:"primary",class:"full-width q-mt-md",type:"submit","no-caps":"",icon:"save",loading:l.loading},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(U,{modelValue:l.proveedorDialog,"onUpdate:modelValue":o[15]||(o[15]=t=>l.proveedorDialog=t),persistent:""},{default:a(()=>[r(w,{style:{width:"520px","max-width":"90vw"}},{default:a(()=>[r(v,{class:"row items-center q-pb-none"},{default:a(()=>[o[22]||(o[22]=e("div",{class:"text-h6"},"Nuevo proveedor",-1)),r(k),r(m,{flat:"",round:"",dense:"",icon:"close",onClick:i.closeProveedorDialog},null,8,["onClick"])]),_:1}),r(v,null,{default:a(()=>[r(D,{ref:"formProveedorRef",onSubmit:i.saveProveedor},{default:a(()=>[e("div",qe,[e("div",Fe,[r(h,{modelValue:l.proveedorForm.nombre,"onUpdate:modelValue":o[10]||(o[10]=t=>l.proveedorForm.nombre=t),label:"Nombre *",dense:"",outlined:"",rules:[t=>!!t||"El nombre es obligatorio"]},null,8,["modelValue","rules"])]),e("div",Ne,[r(h,{modelValue:l.proveedorForm.ci,"onUpdate:modelValue":o[11]||(o[11]=t=>l.proveedorForm.ci=t),label:"CI",dense:"",outlined:""},null,8,["modelValue"])]),e("div",Qe,[r(h,{modelValue:l.proveedorForm.telefono,"onUpdate:modelValue":o[12]||(o[12]=t=>l.proveedorForm.telefono=t),label:"Tel\xE9fono",dense:"",outlined:""},null,8,["modelValue"])]),e("div",Ie,[r(h,{modelValue:l.proveedorForm.email,"onUpdate:modelValue":o[13]||(o[13]=t=>l.proveedorForm.email=t),label:"Email",type:"email",dense:"",outlined:""},null,8,["modelValue"])]),e("div",Ee,[r(h,{modelValue:l.proveedorForm.direccion,"onUpdate:modelValue":o[14]||(o[14]=t=>l.proveedorForm.direccion=t),label:"Direcci\xF3n",type:"textarea",autogrow:"",dense:"",outlined:""},null,8,["modelValue"])])]),e("div",Se,[r(k),r(m,{flat:"",label:"Cancelar",color:"grey-8",onClick:i.closeProveedorDialog},null,8,["onClick"]),r(m,{color:"primary",label:"Guardar",icon:"save",type:"submit",loading:l.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o[23]||(o[23]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}var $e=N(R,[["render",Ge]]);export{$e as default};
