import{_ as G,O as n,P as m,Q as o,R as e,S as d,aG as g,$ as f,J as h,V as b,T as c,X as v,Y as U,Z as q,aH as x,aI as C,U as Q,W as N,aJ as y,aK as S}from"./index.dcf4c9a7.js";import{a as P,b as u}from"./QMenu.5523be22.js";import{Q as V}from"./QItemLabel.2feff48c.js";import{Q as E}from"./QList.00ed4926.js";import{Q as z}from"./QBtnDropdown.99db19c0.js";import{Q as w,a as B}from"./QTable.1919beb8.js";import{Q as I}from"./QChip.89e7c2ad.js";import{Q as _}from"./QSpace.f6407af7.js";import{Q as O}from"./QSelect.d0f76d6f.js";import{Q as A}from"./QForm.87df63e0.js";import{Q as T}from"./QPage.1388b6e9.js";import{C as k}from"./ClosePopup.7ddea8fc.js";import"./moment.40bc58bf.js";import"./QBtnGroup.3b58a508.js";import"./QMarkupTable.e38dd6a0.js";import"./format.2cae61da.js";const L={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionPeriodo:"",gestiones:[],filter:"",roles:["Vendedor","Administrador"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"role",label:"Rol",align:"left",field:"role"},{name:"permisos",label:"Permisos",align:"left",field:"permisos"}],permisos:[],dialogPermisos:!1}},mounted(){this.usersGet(),this.permisosGet()},methods:{guardarPermisos(){this.loading=!0,this.$axios.put(`users/${this.user.id}/permisos`,{permissions:this.user.permissionsSelected}).then(()=>{this.$alert.success("Permisos actualizados"),this.dialogPermisos=!1,this.usersGet()}).catch(a=>{var s,t;this.$alert.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Error al actualizar permisos")}).finally(()=>{this.loading=!1})},permisosGet(){this.loading=!0,this.$axios.get("permisos").then(a=>{this.permisos=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Area"},this.actionPeriodo="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.$axios.get("users").then(a=>{this.users=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(a=>{this.gestiones=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Periodo creado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(a=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Periodo actualizado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},dialogPermisosClick(a){var s;this.dialogPermisos=!0,this.user={...a,permissionsSelected:((s=a.permissions)==null?void 0:s.map(t=>t.name))||[]}},userEditPassword(a){this.user={...a},this.$alert.dialogPrompt("Nueva contrase\xF1a","Ingrese la nueva contrase\xF1a","password").onOk(s=>{this.$axios.put("updatePassword/"+a.id,{password:s}).then(t=>{this.usersGet(),this.$alert.success("Contrase\xF1a actualizada")}).catch(t=>{this.$alert.error(t.response.data.message)})})},userEdit(a){this.user={...a},this.actionPeriodo="Editar",this.userDialog=!0},userDelete(a){this.$alert.dialog("\xBFDesea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+a).then(s=>{this.usersGet(),this.$alert.success("Periodo eliminado")}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})})}}},R={style:{padding:"0",margin:"0",width:"150px"}},F={class:"text-right"},J={class:"text-right q-mt-md"};function H(a,s,t,K,r,i){return n(),m(T,{class:"q-pa-md"},{default:o(()=>[e(B,{rows:r.users,columns:r.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:r.filter},{"top-right":o(()=>[e(d,{color:"primary",label:"Actualizar",onClick:i.usersGet,"no-caps":"",icon:"refresh",loading:r.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),e(d,{color:"green",label:"Nuevo",onClick:i.userNew,"no-caps":"",icon:"add_circle_outline",loading:r.loading},null,8,["onClick","loading"]),e(g,{modelValue:r.filter,"onUpdate:modelValue":s[0]||(s[0]=l=>r.filter=l),label:"Buscar",dense:"",outlined:""},{append:o(()=>[e(f,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":o(l=>[e(w,{props:l},{default:o(()=>[e(z,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:o(()=>[e(E,null,{default:o(()=>[h((n(),m(P,{clickable:"",onClick:p=>i.userEdit(l.row)},{default:o(()=>[e(u,{avatar:""},{default:o(()=>[e(f,{name:"edit"})]),_:1}),e(u,null,{default:o(()=>[e(V,null,{default:o(()=>s[13]||(s[13]=[b("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k]]),h((n(),m(P,{clickable:"",onClick:p=>i.userDelete(l.row.id)},{default:o(()=>[e(u,{avatar:""},{default:o(()=>[e(f,{name:"delete"})]),_:1}),e(u,null,{default:o(()=>[e(V,null,{default:o(()=>s[14]||(s[14]=[b("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k]]),h((n(),m(P,{clickable:"",onClick:p=>i.userEditPassword(l.row)},{default:o(()=>[e(u,{avatar:""},{default:o(()=>[e(f,{name:"edit"})]),_:1}),e(u,null,{default:o(()=>[e(V,null,{default:o(()=>s[15]||(s[15]=[b("Cambiar contrase\xF1a")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k]]),h((n(),m(P,{clickable:"",onClick:p=>i.dialogPermisosClick(l.row)},{default:o(()=>[e(u,{avatar:""},{default:o(()=>[e(f,{name:"lock_open"})]),_:1}),e(u,null,{default:o(()=>[e(V,null,{default:o(()=>s[16]||(s[16]=[b("Permisos")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":o(l=>[e(w,{props:l},{default:o(()=>[e(I,{label:l.row.role,color:l.row.color,"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-permisos":o(l=>[e(w,{props:l},{default:o(()=>[c("ul",R,[(n(!0),v(q,null,U(l.row.permissions,(p,D)=>(n(),v("li",{key:D,style:{"list-style":"none",padding:"0",margin:"0"}},Q(p.name),1))),128))])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),e(y,{modelValue:r.userDialog,"onUpdate:modelValue":s[9]||(s[9]=l=>r.userDialog=l),persistent:""},{default:o(()=>[e(x,null,{default:o(()=>[e(C,{class:"q-pb-none row items-center"},{default:o(()=>[c("div",null,Q(r.actionPeriodo)+" user ",1),e(_),e(d,{icon:"close",flat:"",round:"",dense:"",onClick:s[1]||(s[1]=l=>r.userDialog=!1)})]),_:1}),e(C,{class:"q-pt-none"},{default:o(()=>[e(A,{onSubmit:s[8]||(s[8]=l=>r.user.id?i.userPut():i.userPost())},{default:o(()=>[e(g,{modelValue:r.user.name,"onUpdate:modelValue":s[2]||(s[2]=l=>r.user.name=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),e(g,{modelValue:r.user.username,"onUpdate:modelValue":s[3]||(s[3]=l=>r.user.username=l),label:"Usuario",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),e(g,{modelValue:r.user.email,"onUpdate:modelValue":s[4]||(s[4]=l=>r.user.email=l),label:"Email",dense:"",outlined:"",hint:""},null,8,["modelValue"]),r.user.id?N("",!0):(n(),m(g,{key:0,modelValue:r.user.password,"onUpdate:modelValue":s[5]||(s[5]=l=>r.user.password=l),label:"Contrase\xF1a",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])),e(O,{modelValue:r.user.role,"onUpdate:modelValue":s[6]||(s[6]=l=>r.user.role=l),label:"Rol",dense:"",outlined:"",options:r.roles,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"]),c("div",F,[e(d,{color:"negative",label:"Cancelar",onClick:s[7]||(s[7]=l=>r.userDialog=!1),"no-caps":"",loading:r.loading},null,8,["loading"]),e(d,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:r.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(y,{modelValue:r.dialogPermisos,"onUpdate:modelValue":s[12]||(s[12]=l=>r.dialogPermisos=l)},{default:o(()=>[e(x,null,{default:o(()=>[e(C,{class:"q-pb-none row items-center"},{default:o(()=>[c("div",null," Permisos de "+Q(r.user.name),1),e(_),e(d,{icon:"close",flat:"",round:"",dense:"",onClick:s[10]||(s[10]=l=>r.dialogPermisos=!1)})]),_:1}),e(C,{class:"q-pt-none"},{default:o(()=>[e(S,{modelValue:r.user.permissionsSelected,"onUpdate:modelValue":s[11]||(s[11]=l=>r.user.permissionsSelected=l),options:r.permisos.map(l=>({label:l.name,value:l.name})),type:"checkbox",color:"green",dense:""},null,8,["modelValue","options"]),c("div",J,[e(d,{label:"Guardar permisos",color:"primary",onClick:i.guardarPermisos,loading:r.loading,"no-caps":""},null,8,["onClick","loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ue=G(L,[["render",H]]);export{ue as default};
