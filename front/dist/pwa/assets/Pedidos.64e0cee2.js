import{_ as F,O as m,P as k,Q as o,T as s,R as e,$ as f,V as u,U as i,aH as w,aI as T,aG as V,S as y,X as g,Y as P,Z as I,W as $,J as Q}from"./index.f5457207.js";import{Q as v,a as r}from"./QItem.f9bf5b17.js";import{Q as _}from"./QItemLabel.ab17f4fc.js";import{Q as A}from"./QSelect.97904e01.js";import{Q as G}from"./QBtnDropdown.8d1780b4.js";import{Q as S}from"./QChip.600a6998.js";import{Q as q}from"./QMarkupTable.8a6b74ab.js";import{Q as B}from"./QPage.562334ad.js";import{C}from"./ClosePopup.acab7d70.js";import{h as D}from"./moment.40bc58bf.js";import"./QMenu.8fa6cab6.js";import"./format.2cae61da.js";import"./QBtnGroup.a996d5ee.js";const E={name:"Pedidos",data(){return{pedidos:[],fechaInicio:D().format("YYYY-MM-DD"),fechaFin:D().format("YYYY-MM-DD"),user:"",users:[],proveedor_id:"",proveedores:[],loading:!1}},mounted(){this.pedidosGet(),this.usersGet(),this.proveedoresGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(l=>({label:l.name,value:l.id}))]},proveedoresTodos(){return[{label:"Todos",value:""},...this.proveedores.map(l=>({label:l.nombre,value:l.id}))]},totalSubtotal(){return this.pedidos.reduce((l,t)=>t.estado==="Activo"?l+Number(t.subtotal||0):l,0).toFixed(2)},totalAnulados(){return this.pedidos.reduce((l,t)=>t.estado==="Anulado"?l+Number(t.subtotal||0):l,0).toFixed(2)}},methods:{pedidosGet(){this.loading=!0,this.$axios.get("pedidos",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user,proveedor_id:this.proveedor_id}}).then(l=>{this.pedidos=l.data}).catch(l=>{var t,p;this.$alert.error(((p=(t=l.response)==null?void 0:t.data)==null?void 0:p.message)||"Error al obtener pedidos")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(l=>{this.users=l.data})},proveedoresGet(){this.$axios.get("proveedores").then(l=>{this.proveedores=l.data})},anular(l){this.$alert.dialog("\xBFAnular este pedido?").onOk(()=>{this.loading=!0,this.$axios.put(`pedidosAnular/${l}`).then(()=>{this.$alert.success("Pedido anulado"),this.pedidosGet()}).finally(()=>{this.loading=!1})})},eliminar(l){this.$alert.dialog("\xBFEliminar este pedido? Esta acci\xF3n no se puede deshacer.").onOk(()=>{this.loading=!0,this.$axios.delete(`pedidos/${l}`).then(()=>{this.$alert.success("Pedido eliminado"),this.pedidosGet()}).catch(t=>{var p,b;this.$alert.error(((b=(p=t.response)==null?void 0:p.data)==null?void 0:b.message)||"Error al eliminar pedido")}).finally(()=>{this.loading=!1})})},whatsapp(l){var a;const t=String(l.telefono||"").replace(/\D/g,"");if(!t){this.$alert.error("Este pedido no tiene tel\xE9fono");return}const p=((a=l.proveedor)==null?void 0:a.nombre)||l.proveedor_nombre||"",b=(l.detalles||[]).filter(h=>Number(h.cantidad||0)>0).map(h=>{var c;const x=h.nombre||((c=h.producto)==null?void 0:c.nombre)||"Producto";return`${h.cantidad} - ${x}`}).join(`
`),d=`Hola ${p}.
Pedido #${l.id} (${l.fecha}).
Detalle:
${b}`,n=`https://wa.me/${t}?text=${encodeURIComponent(d)}`;window.open(n,"_blank")}}},Y={class:"row q-col-gutter-sm"},U={class:"col-12 col-md-4"},N={class:"col-12 col-md-4"},M={class:"col-12 col-md-4"},z={class:"row q-col-gutter-sm items-end"},O={class:"col-12 col-md-2"},L={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},W={class:"col-12 col-md-2"},j={class:"col-12 col-md-2"},J={class:"q-pa-none q-ma-none"},X={key:0};function Z(l,t,p,b,d,n){return m(),k(B,{class:"q-pa-xs"},{default:o(()=>[s("div",Y,[s("div",U,[e(w,{flat:"",bordered:""},{default:o(()=>[e(v,{class:"bg-indigo text-white"},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(f,{name:"shopping_cart",size:"40px"})]),_:1}),e(r,null,{default:o(()=>[e(_,{caption:"",class:"text-white"},{default:o(()=>t[5]||(t[5]=[u("Subtotal Pedidos")])),_:1}),e(_,{class:"text-h5 text-weight-bold"},{default:o(()=>[u(i(n.totalSubtotal)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",N,[e(w,{flat:"",bordered:""},{default:o(()=>[e(v,{class:"bg-negative text-white"},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(f,{name:"cancel",size:"40px"})]),_:1}),e(r,null,{default:o(()=>[e(_,{caption:"",class:"text-white"},{default:o(()=>t[6]||(t[6]=[u("Anulados")])),_:1}),e(_,{class:"text-h5 text-weight-bold"},{default:o(()=>[u(i(n.totalAnulados)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",M,[e(w,{flat:"",bordered:""},{default:o(()=>[e(v,{class:"bg-green text-white"},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(f,{name:"receipt_long",size:"40px"})]),_:1}),e(r,null,{default:o(()=>[e(_,{caption:"",class:"text-white"},{default:o(()=>t[7]||(t[7]=[u("Total Pedidos")])),_:1}),e(_,{class:"text-h5 text-weight-bold"},{default:o(()=>[u(i(d.pedidos.length),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),e(w,{flat:"",bordered:"",class:"q-mt-sm"},{default:o(()=>[e(T,{class:"q-pa-sm"},{default:o(()=>[s("div",z,[s("div",O,[e(V,{modelValue:d.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=a=>d.fechaInicio=a),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),s("div",L,[e(V,{modelValue:d.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=a=>d.fechaFin=a),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),s("div",H,[e(A,{modelValue:d.user,"onUpdate:modelValue":t[2]||(t[2]=a=>d.user=a),options:n.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",R,[e(A,{modelValue:d.proveedor_id,"onUpdate:modelValue":t[3]||(t[3]=a=>d.proveedor_id=a),options:n.proveedoresTodos,label:"Proveedor",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",W,[e(y,{color:"primary",label:"Buscar",icon:"search","no-caps":"",loading:d.loading,onClick:n.pedidosGet},null,8,["loading","onClick"])]),s("div",j,[e(y,{color:"positive",label:"Pedido",icon:"add_circle_outline","no-caps":"",onClick:t[4]||(t[4]=a=>l.$router.push({name:"pedidos-create"}))})])])]),_:1})]),_:1}),e(q,{dense:"","wrap-cells":"",class:"q-mt-sm"},{default:o(()=>[t[12]||(t[12]=s("thead",null,[s("tr",{class:"bg-primary text-white"},[s("th",null,"Acciones"),s("th",null,"ID"),s("th",null,"Fecha"),s("th",null,"Proveedor"),s("th",null,"Tel\xE9fono"),s("th",null,"Usuario"),s("th",null,"Estado"),s("th",null,"Detalle")])],-1)),s("tbody",null,[(m(!0),g(I,null,P(d.pedidos,a=>{var h,x;return m(),g("tr",{key:a.id},[s("td",null,[e(G,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:o(()=>[Q((m(),k(v,{clickable:"",onClick:c=>n.whatsapp(a)},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(f,{name:"phone",color:"green"})]),_:1}),e(r,null,{default:o(()=>t[8]||(t[8]=[u("Enviar WhatsApp")])),_:1})]),_:2},1032,["onClick"])),[[C]]),Q((m(),k(v,{clickable:"",onClick:c=>n.anular(a.id)},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(f,{name:"delete"})]),_:1}),e(r,null,{default:o(()=>t[9]||(t[9]=[u("Anular")])),_:1})]),_:2},1032,["onClick"])),[[C]]),Q((m(),k(v,{clickable:"",onClick:c=>n.eliminar(a.id)},{default:o(()=>[e(r,{avatar:""},{default:o(()=>[e(f,{name:"delete_forever",color:"negative"})]),_:1}),e(r,null,{default:o(()=>t[10]||(t[10]=[u("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[C]])]),_:2},1024)]),s("td",null,i(a.id),1),s("td",null,i(a.fecha)+" "+i(a.hora),1),s("td",null,i(((h=a.proveedor)==null?void 0:h.nombre)||a.proveedor_nombre||"-"),1),s("td",null,i(a.telefono||"-"),1),s("td",null,i(((x=a.user)==null?void 0:x.name)||"-"),1),s("td",null,[e(S,{color:a.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:o(()=>[u(i(a.estado),1)]),_:2},1032,["color"])]),s("td",null,[s("ul",J,[(m(!0),g(I,null,P(a.detalles,c=>(m(),g("li",{key:c.id},i(c.cantidad)+" x "+i(c.nombre),1))),128))])])])}),128)),!d.loading&&d.pedidos.length===0?(m(),g("tr",X,t[11]||(t[11]=[s("td",{colspan:"9",class:"text-center text-grey q-pa-md"},"Sin pedidos",-1)]))):$("",!0)])]),_:1})]),_:1})}var me=F(E,[["render",Z]]);export{me as default};
