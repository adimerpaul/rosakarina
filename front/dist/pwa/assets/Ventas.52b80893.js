import{_ as L,O as m,P as h,Q as s,T as o,R as t,aI as p,$ as v,V as u,U as i,aH as b,aG as C,S as f,J as k,X as x,Y as E,Z as I,W as N,bg as B,aJ as T,as as y}from"./index.05ec8a00.js";import{a as _,b as c}from"./QMenu.20988a0c.js";import{Q as V}from"./QItemLabel.be1b8919.js";import{Q as q}from"./QSelect.0e926958.js";import{Q as A}from"./QBtnDropdown.42d141fb.js";import{Q as F}from"./QChip.8cb0ba17.js";import{Q as S}from"./QMarkupTable.60ba416e.js";import{Q as Y}from"./QSpace.0cf68ae0.js";import{Q as M}from"./QPage.25b4f3bb.js";import{C as G}from"./ClosePopup.cd1cf7f0.js";import{h as Q}from"./moment.40bc58bf.js";import{I as U}from"./Imprimir.98a3fadf.js";import{E as z}from"./Excel.a5e16faf.js";import"./format.2cae61da.js";import"./QBtnGroup.5b18e740.js";import"./_commonjsHelpers.a26ce4be.js";const P={name:"Ventas",data(){return{ventas:[],venta:{},fechaInicio:Q().format("YYYY-MM-DD"),fechaFin:Q().format("YYYY-MM-DD"),loading:!1,users:[],user:"",devDialog:!1,gastoDialog:!1,gastoLoading:!1,gastoForm:{fecha:Q().format("YYYY-MM-DD"),concepto:"",monto:null,tipo_pago:"Efectivo"}}},mounted(){this.ventasGet(),this.usersGet()},methods:{openGastoDialog(){this.gastoForm={fecha:Q().format("YYYY-MM-DD"),concepto:"",monto:null,tipo_pago:"Efectivo"},this.gastoDialog=!0},guardarGasto(){const a=String(this.gastoForm.concepto||"").trim(),e=Number(this.gastoForm.monto);if(!a){this.$q.notify({type:"warning",message:"Ingrese el concepto del gasto"});return}if(isNaN(e)||e<=0){this.$q.notify({type:"warning",message:"Ingrese un monto v\xE1lido"});return}this.gastoLoading=!0,this.$axios.post("ventasGasto",{fecha:this.gastoForm.fecha,concepto:a,monto:e,tipo_pago:this.gastoForm.tipo_pago}).then(()=>{this.$alert.success("Gasto registrado"),this.gastoDialog=!1,this.ventasGet()}).catch(r=>{var g,n;this.$alert.error(((n=(g=r==null?void 0:r.response)==null?void 0:g.data)==null?void 0:n.message)||"Error al registrar gasto")}).finally(()=>{this.gastoLoading=!1})},devolverProducto(a,e,r){this.$q.dialog({title:"Devolver producto",message:`Ingrese la cantidad a devolver (vendido: ${r}):`,prompt:{model:r,type:"number",isValid:g=>{const n=Number(g);return!isNaN(n)&&n>0&&n<=r},label:"Cantidad a devolver",hint:`Debe ser un n\xFAmero entre 1 y ${r}`,mask:"##########"},cancel:!0,persistent:!0}).onOk(g=>{const n=Number(g);if(isNaN(n)||n<=0||n>r){this.$alert.error("Cantidad inv\xE1lida");return}this.$axios.post("ventasDevolverProducto",{venta_id:a,venta_detalle_id:e,cantidad:n}).then(()=>{this.$alert.success("Producto devuelto correctamente"),this.devDialog=!1,this.ventasGet()}).catch(d=>{this.$alert.error(d.response.data.message)})})},openDevolver(a){this.venta=a,this.devDialog=!0},exportExcel(){const a=(this.ventas||[]).filter(r=>String(r.estado).toLowerCase()==="activo");if(a.length===0){this.$q.notify({type:"warning",message:"No hay ventas ACTIVAS para exportar"});return}const e=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:"fecha"},{label:"Cliente",value:"nombre"},{label:"Usuario",value:"user.name"},{label:"Estado",value:"estado"},{label:"Total",value:"total"},{label:"Tipo comprobante",value:"tipo_comprobante"},{label:"Detalle",value:"detailsText"}],content:a}];z.export(e,"Ventas_Activas")},usersGet(){this.$axios.get("users").then(a=>{this.users=a.data}).catch(a=>{this.$alert.error(a.response.data.message)})},imprimir(a){U.reciboVentaSimple(a)},tipoVentasChange(a){this.$axios.put(`tipoVentasChange/${a}`).then(()=>{this.$alert.success("Tipo de venta cambiado"),this.ventasGet()}).catch(e=>{this.$alert.error(e.response.data.message)})},anular(a){this.$alert.dialog("\xBFEst\xE1 seguro de anular?").onOk(()=>{this.$axios.put(`ventasAnular/${a}`).then(()=>{this.$alert.success("Anulado"),this.ventasGet()}).catch(e=>{this.$alert.error(e.response.data.message)})})},ventasGet(){this.loading=!0,this.$axios.get("ventas",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(a=>{this.ventas=a.data}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})}},computed:{totalQR(){return this.ventas.reduce((a,e)=>String(e.tipo_comprobante||"").toLowerCase()!=="gastos"&&e.tipo_pago==="QR"&&e.estado==="Activo"?a+parseFloat(e.total||0):a,0)},totalEfectivo(){return this.ventas.reduce((a,e)=>String(e.tipo_comprobante||"").toLowerCase()!=="gastos"&&e.tipo_pago==="Efectivo"&&e.estado==="Activo"?a+parseFloat(e.total||0):a,0)},totalGastos(){return this.ventas.reduce((a,e)=>String(e.tipo_comprobante||"").toLowerCase()==="gastos"&&e.estado==="Activo"?a+parseFloat(e.total||0):a,0)},totalVentas(){return this.ventas.reduce((a,e)=>String(e.tipo_comprobante||"").toLowerCase()!=="gastos"&&e.estado==="Activo"?a+parseFloat(e.total||0):a,0)},usersTodos(){return[{label:"Todos",value:""},...this.users.map(a=>({label:a.name,value:a.id}))]},totalInternos(){return this.ventas.reduce((a,e)=>String(e.tipo_comprobante||"").toLowerCase()!=="gastos"&&e.tipo_venta==="Internado"&&e.estado==="Activo"?a+parseFloat(e.total||0):a,0)},totalExternos(){return this.ventas.reduce((a,e)=>String(e.tipo_comprobante||"").toLowerCase()!=="gastos"&&e.tipo_venta==="Externo"&&e.estado==="Activo"?a+parseFloat(e.total||0):a,0)}}},R={class:"row"},O={class:"col-12 col-md-4 q-pa-xs"},H={class:"col-12 col-md-4 q-pa-xs"},j={class:"col-12 col-md-4 q-pa-xs"},J={class:"col-12"},W={class:"row q-col-gutter-sm items-center q-pa-sm"},X={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},K={class:"col-12 col-md-2"},$={class:"col-12 col-md-1"},ee={class:"col-12 col-md-1 text-right"},te={class:"col-12 col-md-2 text-right"},oe={class:"row justify-end q-gutter-sm"},le={class:"col-12 col-md-2 text-right"},se={class:"text-bold"},ae={key:0,class:"text-negative"},ne={key:1},ie=["innerHTML"],re={class:"text-center"},de={style:{"max-width":"360px",overflow:"hidden","text-overflow":"ellipsis"}},ue={class:"text-center"},ce={class:"text-center"},me={class:"text-center"};function pe(a,e,r,g,n,d){return m(),h(M,{class:"q-pa-xs"},{default:s(()=>[o("div",R,[o("div",O,[t(b,{flat:"",bordered:""},{default:s(()=>[t(p,{class:"q-pa-none"},{default:s(()=>[t(_,{class:"bg-indigo"},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),t(c,null,{default:s(()=>[t(V,{caption:"",class:"text-white"},{default:s(()=>e[13]||(e[13]=[u(" Neto ")])),_:1}),t(V,{class:"text-white text-h4"},{default:s(()=>[u(i(d.totalVentas-d.totalGastos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",H,[t(b,{flat:"",bordered:""},{default:s(()=>[t(p,{class:"q-pa-none"},{default:s(()=>[t(_,{class:"bg-green"},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),t(c,null,{default:s(()=>[t(V,{caption:"",class:"text-white"},{default:s(()=>e[14]||(e[14]=[u("Ventas")])),_:1}),t(V,{class:"text-white text-h4"},{default:s(()=>[u(i(d.totalVentas)+" Bs",1)]),_:1})]),_:1}),t(c,{side:"",class:"text-white text-subtitle2"},{default:s(()=>[u(" QR: "+i(d.totalQR)+" Bs",1),e[15]||(e[15]=o("br",null,null,-1)),u(" Efectivo: "+i(d.totalEfectivo)+" Bs ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",j,[t(b,{flat:"",bordered:""},{default:s(()=>[t(p,{class:"q-pa-none"},{default:s(()=>[t(_,{class:"bg-red"},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),t(c,null,{default:s(()=>[t(V,{caption:"",class:"text-white"},{default:s(()=>e[16]||(e[16]=[u("Gastos")])),_:1}),t(V,{class:"text-white text-h4"},{default:s(()=>[u(i(d.totalGastos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",J,[t(b,{flat:"",bordered:""},{default:s(()=>[t(p,{class:"q-pa-none"},{default:s(()=>[o("div",W,[o("div",X,[t(C,{modelValue:n.fechaInicio,"onUpdate:modelValue":e[0]||(e[0]=l=>n.fechaInicio=l),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",Z,[t(C,{modelValue:n.fechaFin,"onUpdate:modelValue":e[1]||(e[1]=l=>n.fechaFin=l),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",K,[t(q,{modelValue:n.user,"onUpdate:modelValue":e[2]||(e[2]=l=>n.user=l),options:d.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",$,[t(f,{color:"primary",label:"Buscar","no-caps":"",icon:"search",loading:n.loading,onClick:e[3]||(e[3]=l=>d.ventasGet()),dense:""},null,8,["loading"])]),o("div",ee,[t(A,{color:"primary",label:"Exportar","no-caps":"",dense:""},{default:s(()=>[k((m(),h(_,{clickable:"",onClick:d.exportExcel},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"file_download"})]),_:1}),t(c,null,{default:s(()=>e[17]||(e[17]=[u("Excel")])),_:1})]),_:1},8,["onClick"])),[[y],[G]])]),_:1})]),o("div",te,[o("div",oe,[t(f,{color:"positive",label:"Nueva venta","no-caps":"",dense:"",icon:"add_circle_outline",loading:n.loading,to:"/ventaNuevo"},null,8,["loading"])])]),o("div",le,[t(f,{color:"negative",label:"Gasto","no-caps":"",dense:"",icon:"remove_circle_outline",onClick:d.openGastoDialog},null,8,["onClick"])])])]),_:1})]),_:1})])]),t(S,{dense:"","wrap-cells":""},{default:s(()=>[e[23]||(e[23]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"ID"),o("th",null,"Fecha"),o("th",null,"Cliente / Concepto"),o("th",null,"Usuario"),o("th",null,"Estado"),o("th",null,"Total"),o("th",null,"Productos"),o("th",null,"Detalles"),o("th",null,"Tipo")])],-1)),o("tbody",null,[n.ventas.length!==0?(m(!0),x(I,{key:0},E(n.ventas,l=>{var D;return m(),x("tr",{key:l.id},[o("td",null,[t(A,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:s(()=>[k((m(),h(_,{clickable:"",onClick:w=>d.imprimir(l)},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"print"})]),_:1}),t(c,null,{default:s(()=>e[18]||(e[18]=[u("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[y],[G]]),k((m(),h(_,{clickable:"",onClick:w=>d.anular(l.id)},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"delete"})]),_:1}),t(c,null,{default:s(()=>e[19]||(e[19]=[u("Anular")])),_:1})]),_:2},1032,["onClick"])),[[y],[G]]),l.estado==="Activo"&&l.tipo_comprobante!=="Gastos"?k((m(),h(_,{key:0,clickable:"",onClick:w=>d.openDevolver(l)},{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(v,{name:"undo"})]),_:1}),t(c,null,{default:s(()=>e[20]||(e[20]=[u("Devolver productos")])),_:1})]),_:2},1032,["onClick"])),[[y],[G]]):N("",!0)]),_:2},1024)]),o("td",null,i(l.id),1),o("td",null,i(l.fecha)+" "+i(l.hora),1),o("td",null,i(l.tipo_comprobante==="Gastos"?l.nombre||"Gasto":l.nombre||"SN"),1),o("td",null,i(((D=l.user)==null?void 0:D.name)||"\u2014"),1),o("td",null,[t(F,{color:l.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:s(()=>[u(i(l.estado),1)]),_:2},1032,["color"])]),o("td",se,[l.tipo_comprobante==="Gastos"?(m(),x("span",ae," - "+i(l.total),1)):(m(),x("span",ne,i(l.total),1)),t(F,{size:"10px",color:l.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:s(()=>[u(i((l.tipo_pago||"E").charAt(0)),1)]),_:2},1032,["color"])]),o("td",null,[o("div",{style:{"max-width":"200px","line-height":"1.2","white-space":"normal",overflow:"hidden","text-overflow":"ellipsis"},innerHTML:l.detailsText||"\u2014"},null,8,ie)]),o("td",null,i(l.detalles||"\u2014"),1),o("td",null,[l.tipo_comprobante==="Gastos"?(m(),h(F,{key:0,color:"negative",class:"text-white",dense:""},{default:s(()=>e[21]||(e[21]=[u(" Gasto ")])),_:1})):(m(),h(F,{key:1,color:"teal",class:"text-white",dense:""},{default:s(()=>e[22]||(e[22]=[u(" Venta ")])),_:1}))])])}),128)):N("",!0)])]),_:1}),t(T,{modelValue:n.gastoDialog,"onUpdate:modelValue":e[10]||(e[10]=l=>n.gastoDialog=l),persistent:""},{default:s(()=>[t(b,{style:{width:"520px","max-width":"95vw"}},{default:s(()=>[t(p,{class:"row items-center q-pb-none"},{default:s(()=>[e[24]||(e[24]=o("div",{class:"text-h6"},"Registrar gasto",-1)),t(Y),t(f,{flat:"",round:"",dense:"",icon:"close",onClick:e[4]||(e[4]=l=>n.gastoDialog=!1)})]),_:1}),t(p,{class:"q-gutter-sm"},{default:s(()=>[t(C,{modelValue:n.gastoForm.fecha,"onUpdate:modelValue":e[5]||(e[5]=l=>n.gastoForm.fecha=l),type:"date",dense:"",outlined:"",label:"Fecha"},null,8,["modelValue"]),t(C,{modelValue:n.gastoForm.concepto,"onUpdate:modelValue":e[6]||(e[6]=l=>n.gastoForm.concepto=l),dense:"",outlined:"",label:"Concepto / Descripci\xF3n"},null,8,["modelValue"]),t(C,{modelValue:n.gastoForm.monto,"onUpdate:modelValue":e[7]||(e[7]=l=>n.gastoForm.monto=l),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",dense:"",outlined:"",label:"Monto (Bs.)"},null,8,["modelValue"]),t(q,{modelValue:n.gastoForm.tipo_pago,"onUpdate:modelValue":e[8]||(e[8]=l=>n.gastoForm.tipo_pago=l),options:["Efectivo","QR","Tarjeta","Transferencia"],dense:"",outlined:"",label:"Tipo pago"},null,8,["modelValue"])]),_:1}),t(B,{align:"right"},{default:s(()=>[t(f,{flat:"",label:"Cancelar","no-caps":"",onClick:e[9]||(e[9]=l=>n.gastoDialog=!1)}),t(f,{color:"negative",label:"Guardar gasto","no-caps":"",loading:n.gastoLoading,onClick:d.guardarGasto},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:n.devDialog,"onUpdate:modelValue":e[12]||(e[12]=l=>n.devDialog=l),persistent:""},{default:s(()=>[t(b,{style:{"max-width":"860px",width:"95vw"}},{default:s(()=>[t(p,{class:"row items-center q-pb-none"},{default:s(()=>[e[25]||(e[25]=o("div",{class:"text-h6"},"Devolver productos",-1)),t(Y),t(f,{flat:"",round:"",dense:"",icon:"close",onClick:e[11]||(e[11]=l=>n.devDialog=!1)})]),_:1}),t(p,null,{default:s(()=>[t(S,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:s(()=>[e[26]||(e[26]=o("thead",null,[o("tr",null,[o("th",null,"#"),o("th",null,"Producto"),o("th",null,"Lote"),o("th",null,"Vencimiento"),o("th",{style:{width:"100px"}},"Vendido"),o("th",{style:{width:"140px"}},"Devolver")])],-1)),o("tbody",null,[(m(!0),x(I,null,E(n.venta.venta_detalles,(l,D)=>{var w;return m(),x("tr",{key:l.id},[o("td",re,i(D+1),1),o("td",de,i(l.nombre||((w=l.producto)==null?void 0:w.nombre)||"\u2014"),1),o("td",ue,i(l.lote||"\u2014"),1),o("td",ce,i(l.fecha_vencimiento||"\u2014"),1),o("td",me,i(l.cantidad),1),o("td",null,[t(f,{size:"sm",color:"negative",label:"Devolver","no-caps":"",onClick:fe=>d.devolverProducto(n.venta.id,l.id,l.cantidad),icon:"undo"},null,8,["onClick"])])])}),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[27]||(e[27]=o("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}var Ie=L(P,[["render",pe]]);export{Ie as default};
