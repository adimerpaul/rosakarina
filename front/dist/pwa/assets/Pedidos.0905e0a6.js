import{_ as F,O as p,P as w,Q as s,T as o,R as e,$ as v,V as u,U as i,aH as x,aI as T,aG as k,S as V,X as _,Y as C,Z as y,W as S,J as I}from"./index.237589b2.js";import{Q as b,a as r}from"./QItem.d8852291.js";import{Q as h}from"./QItemLabel.477f331d.js";import{Q as P}from"./QSelect.259b2a24.js";import{Q as q}from"./QBtnDropdown.f1f79afb.js";import{Q as B}from"./QChip.f694817e.js";import{Q as G}from"./QMarkupTable.954968cf.js";import{Q as Y}from"./QPage.74e826ff.js";import{C as A}from"./ClosePopup.9a397734.js";import{h as D}from"./moment.40bc58bf.js";import"./QMenu.b1279afe.js";import"./format.2cae61da.js";import"./QBtnGroup.518ef310.js";const U={name:"Pedidos",data(){return{pedidos:[],fechaInicio:D().format("YYYY-MM-DD"),fechaFin:D().format("YYYY-MM-DD"),user:"",users:[],proveedor_id:"",proveedores:[],loading:!1}},mounted(){this.pedidosGet(),this.usersGet(),this.proveedoresGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(l=>({label:l.name,value:l.id}))]},proveedoresTodos(){return[{label:"Todos",value:""},...this.proveedores.map(l=>({label:l.nombre,value:l.id}))]},totalSubtotal(){return this.pedidos.reduce((l,t)=>t.estado==="Activo"?l+Number(t.subtotal||0):l,0).toFixed(2)},totalAnulados(){return this.pedidos.reduce((l,t)=>t.estado==="Anulado"?l+Number(t.subtotal||0):l,0).toFixed(2)}},methods:{pedidosGet(){this.loading=!0,this.$axios.get("pedidos",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user,proveedor_id:this.proveedor_id}}).then(l=>{this.pedidos=l.data}).catch(l=>{var t,f;this.$alert.error(((f=(t=l.response)==null?void 0:t.data)==null?void 0:f.message)||"Error al obtener pedidos")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(l=>{this.users=l.data})},proveedoresGet(){this.$axios.get("proveedores").then(l=>{this.proveedores=l.data})},anular(l){this.$alert.dialog("\xBFAnular este pedido?").onOk(()=>{this.loading=!0,this.$axios.put(`pedidosAnular/${l}`).then(()=>{this.$alert.success("Pedido anulado"),this.pedidosGet()}).finally(()=>{this.loading=!1})})},whatsapp(l){var a;const t=String(l.telefono||"").replace(/\D/g,"");if(!t){this.$alert.error("Este pedido no tiene tel\xE9fono");return}const f=((a=l.proveedor)==null?void 0:a.nombre)||l.proveedor_nombre||"",Q=(l.detalles||[]).filter(c=>Number(c.cantidad||0)>0).map(c=>{var m;const g=c.nombre||((m=c.producto)==null?void 0:m.nombre)||"Producto";return`${c.cantidad} - ${g}`}).join(`
`),d=`Hola ${f}.
Pedido #${l.id} (${l.fecha}).
Detalle:
${Q}`,n=`https://wa.me/${t}?text=${encodeURIComponent(d)}`;window.open(n,"_blank")}}},N={class:"row q-col-gutter-sm"},$={class:"col-12 col-md-4"},E={class:"col-12 col-md-4"},M={class:"col-12 col-md-4"},z={class:"row q-col-gutter-sm items-end"},L={class:"col-12 col-md-2"},O={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},W={class:"col-12 col-md-2"},j={class:"col-12 col-md-2"},J={class:"q-pa-none q-ma-none"},X={key:0};function Z(l,t,f,Q,d,n){return p(),w(Y,{class:"q-pa-xs"},{default:s(()=>[o("div",N,[o("div",$,[e(x,{flat:"",bordered:""},{default:s(()=>[e(b,{class:"bg-indigo text-white"},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(v,{name:"shopping_cart",size:"40px"})]),_:1}),e(r,null,{default:s(()=>[e(h,{caption:"",class:"text-white"},{default:s(()=>t[5]||(t[5]=[u("Subtotal Pedidos")])),_:1}),e(h,{class:"text-h5 text-weight-bold"},{default:s(()=>[u(i(n.totalSubtotal)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",E,[e(x,{flat:"",bordered:""},{default:s(()=>[e(b,{class:"bg-negative text-white"},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(v,{name:"cancel",size:"40px"})]),_:1}),e(r,null,{default:s(()=>[e(h,{caption:"",class:"text-white"},{default:s(()=>t[6]||(t[6]=[u("Anulados")])),_:1}),e(h,{class:"text-h5 text-weight-bold"},{default:s(()=>[u(i(n.totalAnulados)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",M,[e(x,{flat:"",bordered:""},{default:s(()=>[e(b,{class:"bg-green text-white"},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(v,{name:"receipt_long",size:"40px"})]),_:1}),e(r,null,{default:s(()=>[e(h,{caption:"",class:"text-white"},{default:s(()=>t[7]||(t[7]=[u("Total Pedidos")])),_:1}),e(h,{class:"text-h5 text-weight-bold"},{default:s(()=>[u(i(d.pedidos.length),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),e(x,{flat:"",bordered:"",class:"q-mt-sm"},{default:s(()=>[e(T,{class:"q-pa-sm"},{default:s(()=>[o("div",z,[o("div",L,[e(k,{modelValue:d.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=a=>d.fechaInicio=a),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",O,[e(k,{modelValue:d.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=a=>d.fechaFin=a),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),o("div",H,[e(P,{modelValue:d.user,"onUpdate:modelValue":t[2]||(t[2]=a=>d.user=a),options:n.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",R,[e(P,{modelValue:d.proveedor_id,"onUpdate:modelValue":t[3]||(t[3]=a=>d.proveedor_id=a),options:n.proveedoresTodos,label:"Proveedor",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",W,[e(V,{color:"primary",label:"Buscar",icon:"search","no-caps":"",loading:d.loading,onClick:n.pedidosGet},null,8,["loading","onClick"])]),o("div",j,[e(V,{color:"positive",label:"Pedido",icon:"add_circle_outline","no-caps":"",onClick:t[4]||(t[4]=a=>l.$router.push({name:"pedidos-create"}))})])])]),_:1})]),_:1}),e(G,{dense:"","wrap-cells":"",class:"q-mt-sm"},{default:s(()=>[t[11]||(t[11]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"ID"),o("th",null,"Fecha"),o("th",null,"Proveedor"),o("th",null,"Tel\xE9fono"),o("th",null,"Usuario"),o("th",null,"Estado"),o("th",null,"Detalle")])],-1)),o("tbody",null,[(p(!0),_(y,null,C(d.pedidos,a=>{var c,g;return p(),_("tr",{key:a.id},[o("td",null,[e(q,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:s(()=>[I((p(),w(b,{clickable:"",onClick:m=>n.whatsapp(a)},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(v,{name:"phone",color:"green"})]),_:1}),e(r,null,{default:s(()=>t[8]||(t[8]=[u("Enviar WhatsApp")])),_:1})]),_:2},1032,["onClick"])),[[A]]),I((p(),w(b,{clickable:"",onClick:m=>n.anular(a.id)},{default:s(()=>[e(r,{avatar:""},{default:s(()=>[e(v,{name:"delete"})]),_:1}),e(r,null,{default:s(()=>t[9]||(t[9]=[u("Anular")])),_:1})]),_:2},1032,["onClick"])),[[A]])]),_:2},1024)]),o("td",null,i(a.id),1),o("td",null,i(a.fecha)+" "+i(a.hora),1),o("td",null,i(((c=a.proveedor)==null?void 0:c.nombre)||a.proveedor_nombre||"-"),1),o("td",null,i(a.telefono||"-"),1),o("td",null,i(((g=a.user)==null?void 0:g.name)||"-"),1),o("td",null,[e(B,{color:a.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:s(()=>[u(i(a.estado),1)]),_:2},1032,["color"])]),o("td",null,[o("ul",J,[(p(!0),_(y,null,C(a.detalles,m=>(p(),_("li",{key:m.id},i(m.cantidad)+" x "+i(m.nombre),1))),128))])])])}),128)),!d.loading&&d.pedidos.length===0?(p(),_("tr",X,t[10]||(t[10]=[o("td",{colspan:"9",class:"text-center text-grey q-pa-md"},"Sin pedidos",-1)]))):S("",!0)])]),_:1})]),_:1})}var me=F(U,[["render",Z]]);export{me as default};
